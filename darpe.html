<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DARPE - CCB</title>

    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.0/dist/lux/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDAZekCEenSVQuYPB2jGqdXc3sllfDqg-M",
            authDomain: "agendawebccb.firebaseapp.com",
            databaseURL: "https://agendawebccb-default-rtdb.firebaseio.com",
            projectId: "agendawebccb",
            storageBucket: "agendawebccb.firebasestorage.app",
            messagingSenderId: "1002090805726",
            appId: "1:1002090805726:web:d9aab35124d174e85d454f"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
    </script>

    <style>
        :root {
            /* Cores principais */
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            
            /* Cores de status */
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #2980b9;
            
            /* Cores de fundo */
            --light-bg: #f5f6fa;
            --card-bg: #ffffff;
            --hover-bg: #edf2f7;
            
            /* Cores de texto */
            --text-primary: #2c3e50;
            --text-secondary: #576574;
            --text-muted: #95a5a6;
            --text-light: #ffffff;
        }

        body {
            background-color: var(--light-bg);
            font-family: 'Inter', sans-serif;
            color: var(--text-primary);
            line-height: 1.6;
        }

        .app-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--text-light);
            padding: 2rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .app-title {
            font-family: 'Poppins', sans-serif;
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            letter-spacing: -0.5px;
        }

        .btn-voltar {
            background-color: var(--card-bg);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.95rem;
            margin-left: 1rem;
        }

        .btn-voltar:hover {
            background-color: var(--light-bg);
            transform: translateX(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15) !important;
        }

        @media (max-width: 768px) {
            .btn-voltar {
                position: relative !important;
                transform: none !important;
                margin-bottom: 1rem;
                display: inline-block;
            }
        }

        .main-content {
            padding: 2rem;
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            border: 1px solid #e1e8ef;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        /* Estilos adicionais para os cards de setores */
        .card .card-title {
            color: var(--primary-color);
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }

        .card .btn-primary {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
            padding: 0.5rem 1.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .card .btn-primary:hover {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .card .card-text {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 1.5rem;
        }

        /* Responsividade para os cards */
        @media (max-width: 768px) {
            .card {
                margin-bottom: 1rem;
            }
        }

        /* Estilos para o formulário de agendamento */
        .scheduling-form {
            display: none;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e1e8ef;
        }

        .form-control {
            margin-bottom: 1rem;
        }

        .scheduling-form.active {
            display: block;
        }
    </style>
</head>
<body>
    <header class="app-header">
        <div class="container position-relative">
            <div class="d-flex justify-content-between align-items-center">
                <a href="index.html" class="btn btn-voltar">
                    <i class="bi bi-arrow-left me-2"></i>
                    Voltar
                </a>
                <button class="btn btn-light" data-bs-toggle="modal" data-bs-target="#cadastroUnidadeModal">
                    <i class="bi bi-plus-circle me-2"></i>
                    Cadastrar Nova Unidade
                </button>
            </div>
            <h1 class="app-title text-center mt-3">DARPE</h1>
            <p class="text-center mb-4">Administração de Ituiutaba-MG</p>
        </div>
    </header>

    <!-- Modal de Cadastro de Unidade -->
    <div class="modal fade" id="cadastroUnidadeModal" tabindex="-1" aria-labelledby="cadastroUnidadeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cadastroUnidadeModalLabel">Cadastro de Nova Unidade</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="unidadeForm" onsubmit="cadastrarUnidade(event)">
                        <div class="row g-3">
                            <div class="col-12">
                                <label for="nomeUnidade" class="form-label">Nome da Unidade</label>
                                <input type="text" class="form-control" id="nomeUnidade" required>
                            </div>
                            
                            <div class="col-md-8">
                                <label for="endereco" class="form-label">Endereço</label>
                                <input type="text" class="form-control" id="endereco" required>
                            </div>
                            
                            <div class="col-md-4">
                                <label for="numero" class="form-label">Número</label>
                                <input type="text" class="form-control" id="numero" required>
                            </div>
                            
                            <div class="col-md-4">
                                <label for="bairro" class="form-label">Bairro</label>
                                <input type="text" class="form-control" id="bairro" required>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="cidade" class="form-label">Cidade</label>
                                <input type="text" class="form-control" id="cidade" required>
                            </div>
                            
                            <div class="col-md-2">
                                <label for="uf" class="form-label">UF</label>
                                <select class="form-select" id="uf" required>
                                    <option value="">UF</option>
                                    <option value="AC">AC</option>
                                    <option value="AL">AL</option>
                                    <option value="AP">AP</option>
                                    <option value="AM">AM</option>
                                    <option value="BA">BA</option>
                                    <option value="CE">CE</option>
                                    <option value="DF">DF</option>
                                    <option value="ES">ES</option>
                                    <option value="GO">GO</option>
                                    <option value="MA">MA</option>
                                    <option value="MT">MT</option>
                                    <option value="MS">MS</option>
                                    <option value="MG">MG</option>
                                    <option value="PA">PA</option>
                                    <option value="PB">PB</option>
                                    <option value="PR">PR</option>
                                    <option value="PE">PE</option>
                                    <option value="PI">PI</option>
                                    <option value="RJ">RJ</option>
                                    <option value="RN">RN</option>
                                    <option value="RS">RS</option>
                                    <option value="RO">RO</option>
                                    <option value="RR">RR</option>
                                    <option value="SC">SC</option>
                                    <option value="SP">SP</option>
                                    <option value="SE">SE</option>
                                    <option value="TO">TO</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="telefone" class="form-label">Telefone</label>
                                <input type="tel" class="form-control" id="telefone" required>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="responsavel" class="form-label">Responsável pela Unidade</label>
                                <input type="text" class="form-control" id="responsavel" required>
                            </div>
                            
                            <div class="col-12">
                                <label for="setor" class="form-label">Setor</label>
                                <select class="form-select" id="setor" required>
                                    <option value="">Selecione o Setor</option>
                                    <option value="1">SETOR 1 - Unidades Prisionais Masculinas e Femininas, e para Menores</option>
                                    <option value="2">SETOR 2 - Clínica de Dependentes e Albergues</option>
                                    <option value="3">SETOR 3 - Forças de Segurança</option>
                                    <option value="4">SETOR 4 - Hospitais, Instituição para Idosos, Setor Educacional</option>
                                    <option value="5">PROJETO EDUCACIONAL CRISTÃO</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <button type="submit" class="btn btn-primary">Cadastrar Unidade</button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="container">
            <div class="row g-4">
                <!-- Setor 1 -->
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <h3 class="card-title h5 fw-bold mb-3">SETOR 1</h3>
                            <p class="card-text">Unidades Prisionais Masculinas e Femininas, e para Menores</p>
                            <button class="btn btn-primary mt-2" onclick="toggleForm('setor1Form')">Agendar Atendimento</button>
                            
                            <form id="setor1Form" class="scheduling-form" onsubmit="submitForm(event, 'setor1')">
                                <div class="form-group">
                                    <label for="setor1-unidade">Unidade de Atendimento</label>
                                    <select class="form-control" id="setor1-unidade" required>
                                        <option value="">Selecione a Unidade</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="setor1-data">Data do Atendimento</label>
                                    <input type="date" class="form-control" id="setor1-data" required>
                                </div>
                                <div class="form-group">
                                    <label for="setor1-horario">Horário do Atendimento</label>
                                    <input type="time" class="form-control" id="setor1-horario" required>
                                </div>
                                <div class="form-group">
                                    <label for="setor1-coordenador">Coordenador do Setor</label>
                                    <input type="text" class="form-control" id="setor1-coordenador" required>
                                </div>
                                <div class="form-group">
                                    <label for="setor1-atendente">Atendente</label>
                                    <input type="text" class="form-control" id="setor1-atendente" required>
                                </div>
                                <button type="submit" class="btn btn-success">Salvar Agendamento</button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Setor 2 -->
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <h3 class="card-title h5 fw-bold mb-3">SETOR 2</h3>
                            <p class="card-text">Clínica de Dependentes e Albergues</p>
                            <button class="btn btn-primary mt-2" onclick="toggleForm('setor2Form')">Agendar Atendimento</button>
                            
                            <form id="setor2Form" class="scheduling-form" onsubmit="submitForm(event, 'setor2')">
                                <div class="form-group">
                                    <label for="setor2-unidade">Unidade de Atendimento</label>
                                    <select class="form-control" id="setor2-unidade" required>
                                        <option value="">Selecione a Unidade</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="setor2-data">Data do Atendimento</label>
                                    <input type="date" class="form-control" id="setor2-data" required>
                                </div>
                                <div class="form-group">
                                    <label for="setor2-horario">Horário do Atendimento</label>
                                    <input type="time" class="form-control" id="setor2-horario" required>
                                </div>
                                <div class="form-group">
                                    <label for="setor2-coordenador">Coordenador do Setor</label>
                                    <input type="text" class="form-control" id="setor2-coordenador" required>
                                </div>
                                <div class="form-group">
                                    <label for="setor2-atendente">Atendente</label>
                                    <input type="text" class="form-control" id="setor2-atendente" required>
                                </div>
                                <button type="submit" class="btn btn-success">Salvar Agendamento</button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Setor 3 -->
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <h3 class="card-title h5 fw-bold mb-3">SETOR 3</h3>
                            <p class="card-text">Forças de Segurança</p>
                            <button class="btn btn-primary mt-2" onclick="toggleForm('setor3Form')">Agendar Atendimento</button>
                            
                            <form id="setor3Form" class="scheduling-form" onsubmit="submitForm(event, 'setor3')">
                                <div class="form-group">
                                    <label for="setor3-unidade">Unidade de Atendimento</label>
                                    <select class="form-control" id="setor3-unidade" required>
                                        <option value="">Selecione a Unidade</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="setor3-data">Data do Atendimento</label>
                                    <input type="date" class="form-control" id="setor3-data" required>
                                </div>
                                <div class="form-group">
                                    <label for="setor3-horario">Horário do Atendimento</label>
                                    <input type="time" class="form-control" id="setor3-horario" required>
                                </div>
                                <div class="form-group">
                                    <label for="setor3-coordenador">Coordenador do Setor</label>
                                    <input type="text" class="form-control" id="setor3-coordenador" required>
                                </div>
                                <div class="form-group">
                                    <label for="setor3-atendente">Atendente</label>
                                    <input type="text" class="form-control" id="setor3-atendente" required>
                                </div>
                                <button type="submit" class="btn btn-success">Salvar Agendamento</button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Setor 4 -->
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <h3 class="card-title h5 fw-bold mb-3">SETOR 4</h3>
                            <p class="card-text">Hospitais, Instituição para Idosos, Setor Educacional</p>
                            <button class="btn btn-primary mt-2" onclick="toggleForm('setor4Form')">Agendar Atendimento</button>
                            
                            <form id="setor4Form" class="scheduling-form" onsubmit="submitForm(event, 'setor4')">
                                <div class="form-group">
                                    <label for="setor4-unidade">Unidade de Atendimento</label>
                                    <select class="form-control" id="setor4-unidade" required>
                                        <option value="">Selecione a Unidade</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="setor4-data">Data do Atendimento</label>
                                    <input type="date" class="form-control" id="setor4-data" required>
                                </div>
                                <div class="form-group">
                                    <label for="setor4-horario">Horário do Atendimento</label>
                                    <input type="time" class="form-control" id="setor4-horario" required>
                                </div>
                                <div class="form-group">
                                    <label for="setor4-coordenador">Coordenador do Setor</label>
                                    <input type="text" class="form-control" id="setor4-coordenador" required>
                                </div>
                                <div class="form-group">
                                    <label for="setor4-atendente">Atendente</label>
                                    <input type="text" class="form-control" id="setor4-atendente" required>
                                </div>
                                <button type="submit" class="btn btn-success">Salvar Agendamento</button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Projeto Educacional -->
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <h3 class="card-title h5 fw-bold mb-3">PROJETO EDUCACIONAL CRISTÃO</h3>
                            <p class="card-text">Desenvolvimento e acompanhamento do projeto educacional</p>
                            <button class="btn btn-primary mt-2" onclick="toggleForm('projetoForm')">Agendar Atendimento</button>
                            
                            <form id="projetoForm" class="scheduling-form" onsubmit="submitForm(event, 'projeto')">
                                <div class="form-group">
                                    <label for="projeto-unidade">Unidade de Atendimento</label>
                                    <select class="form-control" id="projeto-unidade" required>
                                        <option value="">Selecione a Unidade</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="projeto-data">Data do Atendimento</label>
                                    <input type="date" class="form-control" id="projeto-data" required>
                                </div>
                                <div class="form-group">
                                    <label for="projeto-horario">Horário do Atendimento</label>
                                    <input type="time" class="form-control" id="projeto-horario" required>
                                </div>
                                <div class="form-group">
                                    <label for="projeto-coordenador">Coordenador do Setor</label>
                                    <input type="text" class="form-control" id="projeto-coordenador" required>
                                </div>
                                <div class="form-group">
                                    <label for="projeto-atendente">Atendente</label>
                                    <input type="text" class="form-control" id="projeto-atendente" required>
                                </div>
                                <button type="submit" class="btn btn-success">Salvar Agendamento</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Cache para as unidades
        let unidadesCache = {};

        // Função para carregar unidades do Firebase
        function carregarUnidades() {
            database.ref('unidades').on('value', (snapshot) => {
                const unidades = snapshot.val();
                if (unidades) {
                    // Limpar cache atual
                    unidadesCache = {};
                    
                    // Organizar unidades por setor
                    Object.entries(unidades).forEach(([key, unidade]) => {
                        if (!unidadesCache[unidade.setor]) {
                            unidadesCache[unidade.setor] = [];
                        }
                        unidadesCache[unidade.setor].push({
                            id: key,
                            ...unidade
                        });
                    });

                    // Atualizar todos os dropdowns
                    atualizarDropdowns();
                }
            });
        }

        // Função para atualizar os dropdowns de unidades
        function atualizarDropdowns() {
            const setores = ['1', '2', '3', '4', '5'];
            const setorNomes = {
                '1': 'setor1',
                '2': 'setor2',
                '3': 'setor3',
                '4': 'setor4',
                '5': 'projeto'
            };

            setores.forEach(setor => {
                const selectId = `${setorNomes[setor]}-unidade`;
                const select = document.getElementById(selectId);
                if (select) {
                    // Limpar opções existentes
                    select.innerHTML = '<option value="">Selecione a Unidade</option>';
                    
                    // Adicionar unidades do setor
                    const unidadesDoSetor = unidadesCache[setor] || [];
                    unidadesDoSetor.forEach(unidade => {
                        const option = document.createElement('option');
                        option.value = unidade.id;
                        option.textContent = unidade.nome;
                        select.appendChild(option);
                    });
                }
            });
        }

        // Função para alternar a visibilidade do formulário
        function toggleForm(formId) {
            const form = document.getElementById(formId);
            form.classList.toggle('active');
        }

        // Modificar a função submitForm para incluir os dados completos da unidade
        function submitForm(event, setor) {
            event.preventDefault();
            
            const unidadeId = document.getElementById(`${setor}-unidade`).value;
            const unidadeSelecionada = unidadesCache[setor === 'projeto' ? '5' : setor[5]]?.find(u => u.id === unidadeId);
            
            if (!unidadeSelecionada) {
                alert('Por favor, selecione uma unidade válida.');
                return;
            }

            const formData = {
                unidade: {
                    id: unidadeSelecionada.id,
                    nome: unidadeSelecionada.nome,
                    endereco: unidadeSelecionada.endereco,
                    numero: unidadeSelecionada.numero,
                    bairro: unidadeSelecionada.bairro,
                    cidade: unidadeSelecionada.cidade,
                    uf: unidadeSelecionada.uf,
                    telefone: unidadeSelecionada.telefone,
                    responsavel: unidadeSelecionada.responsavel
                },
                data: document.getElementById(`${setor}-data`).value,
                horario: document.getElementById(`${setor}-horario`).value,
                coordenador: document.getElementById(`${setor}-coordenador`).value,
                atendente: document.getElementById(`${setor}-atendente`).value,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };

            // Salvar no Firebase
            database.ref(`agendamentos/${setor}`).push(formData)
                .then(() => {
                    alert('Agendamento salvo com sucesso!');
                    document.getElementById(`${setor}Form`).reset();
                    toggleForm(`${setor}Form`);
                })
                .catch((error) => {
                    alert('Erro ao salvar agendamento: ' + error.message);
                });
        }

        // Função para formatar telefone
        function formatarTelefone(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 11) value = value.slice(0, 11);
            
            if (value.length > 10) {
                value = value.replace(/^(\d{2})(\d{5})(\d{4}).*/, '($1) $2-$3');
            } else if (value.length > 6) {
                value = value.replace(/^(\d{2})(\d{4})(\d{0,4}).*/, '($1) $2-$3');
            } else if (value.length > 2) {
                value = value.replace(/^(\d{2})(\d{0,5})/, '($1) $2');
            } else if (value.length > 0) {
                value = value.replace(/^(\d*)/, '($1');
            }
            
            input.value = value;
        }

        // Adicionar máscara ao campo de telefone
        document.getElementById('telefone').addEventListener('input', function() {
            formatarTelefone(this);
        });

        // Função para cadastrar unidade
        function cadastrarUnidade(event) {
            event.preventDefault();
            
            const unidadeData = {
                nome: document.getElementById('nomeUnidade').value,
                endereco: document.getElementById('endereco').value,
                numero: document.getElementById('numero').value,
                bairro: document.getElementById('bairro').value,
                cidade: document.getElementById('cidade').value,
                uf: document.getElementById('uf').value,
                telefone: document.getElementById('telefone').value,
                responsavel: document.getElementById('responsavel').value,
                setor: document.getElementById('setor').value,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };

            // Salvar no Firebase
            database.ref('unidades').push(unidadeData)
                .then(() => {
                    alert('Unidade cadastrada com sucesso!');
                    document.getElementById('unidadeForm').reset();
                    bootstrap.Modal.getInstance(document.getElementById('cadastroUnidadeModal')).hide();
                })
                .catch((error) => {
                    alert('Erro ao cadastrar unidade: ' + error.message);
                });
        }

        // Carregar unidades ao inicializar a página
        document.addEventListener('DOMContentLoaded', () => {
            carregarUnidades();
        });
    </script>
</body>
</html> 
