<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DARPE - CCB</title>

    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.0/dist/lux/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDAZekCEenSVQuYPB2jGqdXc3sllfDqg-M",
            authDomain: "agendawebccb.firebaseapp.com",
            databaseURL: "https://agendawebccb-default-rtdb.firebaseio.com",
            projectId: "agendawebccb",
            storageBucket: "agendawebccb.firebasestorage.app",
            messagingSenderId: "1002090805726",
            appId: "1:1002090805726:web:d9aab35124d174e85d454f"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
    </script>

    <style>
        :root {
            /* Cores principais */
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            
            /* Cores de status */
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #2980b9;
            
            /* Cores de fundo */
            --light-bg: #f5f6fa;
            --card-bg: #ffffff;
            --hover-bg: #edf2f7;
            
            /* Cores de texto */
            --text-primary: #2c3e50;
            --text-secondary: #576574;
            --text-muted: #95a5a6;
            --text-light: #ffffff;
        }

        body {
            background-color: var(--light-bg);
            font-family: 'Inter', sans-serif;
            color: var(--text-primary);
            line-height: 1.6;
        }

        .app-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--text-light);
            padding: 2rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .app-title {
            font-family: 'Poppins', sans-serif;
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            letter-spacing: -0.5px;
        }

        .btn-voltar {
            background-color: var(--card-bg);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.95rem;
            margin-left: 1rem;
        }

        .btn-voltar:hover {
            background-color: var(--light-bg);
            transform: translateX(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15) !important;
        }

        @media (max-width: 768px) {
            .btn-voltar {
                position: relative !important;
                transform: none !important;
                margin-bottom: 1rem;
                display: inline-block;
            }
        }

        .main-content {
            padding: 2rem;
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            border: 1px solid #e1e8ef;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        /* Estilos adicionais para os cards de setores */
        .card .card-title {
            color: var(--primary-color);
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }

        .card .btn-primary {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
            padding: 0.5rem 1.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .card .btn-primary:hover {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .card .card-text {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 1.5rem;
        }

        /* Responsividade para os cards */
        @media (max-width: 768px) {
            .card {
                margin-bottom: 1rem;
            }
        }

        /* Estilos para o formulário de agendamento */
        .scheduling-form {
            display: none;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e1e8ef;
        }

        .form-control {
            margin-bottom: 1rem;
        }

        .scheduling-form.active {
            display: block;
        }
    </style>
</head>
<body>
    <header class="app-header">
        <div class="container position-relative">
            <div class="d-flex justify-content-between align-items-center">
                <a href="index.html" class="btn btn-voltar">
                    <i class="bi bi-arrow-left me-2"></i>
                    Voltar
                </a>
                <div class="d-flex flex-column gap-2">
                    <button class="btn btn-light" data-bs-toggle="modal" data-bs-target="#cadastroUnidadeModal">
                        <i class="bi bi-plus-circle me-2"></i>
                        Cadastrar Nova Unidade
                    </button>
                    <button class="btn btn-light" data-bs-toggle="modal" data-bs-target="#agendamentoModal">
                        <i class="bi bi-calendar-plus me-2"></i>
                        Agendar Atendimento
                    </button>
                    <button class="btn btn-light" data-bs-toggle="modal" data-bs-target="#cadastroColaboradorModal">
                        <i class="bi bi-person-plus me-2"></i>
                        Cadastrar Colaborador
                    </button>
                </div>
            </div>
            <h1 class="app-title text-center mt-3">DARPE</h1>
            <p class="text-center mb-4">Administração de Ituiutaba-MG</p>
        </div>
    </header>

    <!-- Modal de Cadastro de Unidade -->
    <div class="modal fade" id="cadastroUnidadeModal" tabindex="-1" aria-labelledby="cadastroUnidadeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cadastroUnidadeModalLabel">Cadastro de Nova Unidade</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="unidadeForm" onsubmit="cadastrarUnidade(event)">
                        <div class="row g-3">
                            <div class="col-12">
                                <label for="nomeUnidade" class="form-label">Nome da Unidade</label>
                                <input type="text" class="form-control" id="nomeUnidade" required>
                            </div>
                            
                            <div class="col-md-8">
                                <label for="endereco" class="form-label">Endereço</label>
                                <input type="text" class="form-control" id="endereco" required>
                            </div>
                            
                            <div class="col-md-4">
                                <label for="numero" class="form-label">Número</label>
                                <input type="text" class="form-control" id="numero" required>
                            </div>
                            
                            <div class="col-md-4">
                                <label for="bairro" class="form-label">Bairro</label>
                                <input type="text" class="form-control" id="bairro" required>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="cidade" class="form-label">Cidade</label>
                                <input type="text" class="form-control" id="cidade" required>
                            </div>
                            
                            <div class="col-md-2">
                                <label for="uf" class="form-label">UF</label>
                                <select class="form-select" id="uf" required>
                                    <option value="">UF</option>
                                    <option value="AC">AC</option>
                                    <option value="AL">AL</option>
                                    <option value="AP">AP</option>
                                    <option value="AM">AM</option>
                                    <option value="BA">BA</option>
                                    <option value="CE">CE</option>
                                    <option value="DF">DF</option>
                                    <option value="ES">ES</option>
                                    <option value="GO">GO</option>
                                    <option value="MA">MA</option>
                                    <option value="MT">MT</option>
                                    <option value="MS">MS</option>
                                    <option value="MG">MG</option>
                                    <option value="PA">PA</option>
                                    <option value="PB">PB</option>
                                    <option value="PR">PR</option>
                                    <option value="PE">PE</option>
                                    <option value="PI">PI</option>
                                    <option value="RJ">RJ</option>
                                    <option value="RN">RN</option>
                                    <option value="RS">RS</option>
                                    <option value="RO">RO</option>
                                    <option value="RR">RR</option>
                                    <option value="SC">SC</option>
                                    <option value="SP">SP</option>
                                    <option value="SE">SE</option>
                                    <option value="TO">TO</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="telefone" class="form-label">Telefone</label>
                                <input type="tel" class="form-control" id="telefone" required>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="responsavel" class="form-label">Responsável pela Unidade</label>
                                <input type="text" class="form-control" id="responsavel" required>
                            </div>
                            
                            <div class="col-12">
                                <label for="setor" class="form-label">Setor</label>
                                <select class="form-select" id="setor" required>
                                    <option value="">Selecione o Setor</option>
                                    <option value="1">SETOR 1 - Unidades Prisionais Masculinas e Femininas, e para Menores</option>
                                    <option value="2">SETOR 2 - Clínica de Dependentes e Albergues</option>
                                    <option value="3">SETOR 3 - Forças de Segurança</option>
                                    <option value="4">SETOR 4 - Hospitais, Instituição para Idosos, Setor Educacional</option>
                                    <option value="5">PROJETO EDUCACIONAL CRISTÃO</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <button type="submit" class="btn btn-primary">Cadastrar Unidade</button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Agendamento -->
    <div class="modal fade" id="agendamentoModal" tabindex="-1" aria-labelledby="agendamentoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="agendamentoModalLabel">Agendar Atendimento</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="agendamentoForm" onsubmit="submitAgendamento(event)">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="setor" class="form-label">Setor</label>
                                <select class="form-control" id="setor-agendamento" required onchange="carregarUnidadesDoSetor()">
                                    <option value="">Selecione o Setor</option>
                                    <option value="1">SETOR 1 - Unidades Prisionais</option>
                                    <option value="2">SETOR 2 - Clínicas e Albergues</option>
                                    <option value="3">SETOR 3 - Forças de Segurança</option>
                                    <option value="4">SETOR 4 - Hospitais e Instituições</option>
                                    <option value="5">PROJETO EDUCACIONAL CRISTÃO</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="unidade-agendamento" class="form-label">Unidade de Atendimento</label>
                                <select class="form-control" id="unidade-agendamento" required>
                                    <option value="">Selecione a Unidade</option>
                                </select>
                            </div>

                            <div class="col-md-6">
                                <label for="data-agendamento" class="form-label">Data do Atendimento</label>
                                <input type="date" class="form-control" id="data-agendamento" required>
                            </div>

                            <div class="col-md-6">
                                <label for="horario-agendamento" class="form-label">Horário do Atendimento</label>
                                <input type="time" class="form-control" id="horario-agendamento" required>
                            </div>

                            <div class="col-md-6">
                                <label for="coordenador-agendamento" class="form-label">Coordenador do Setor</label>
                                <input type="text" class="form-control" id="coordenador-agendamento" required>
                            </div>

                            <div class="col-md-6">
                                <label for="atendente-agendamento" class="form-label">Atendente</label>
                                <input type="text" class="form-control" id="atendente-agendamento" required>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <button type="submit" class="btn btn-success">Salvar Agendamento</button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Cadastro de Colaborador -->
    <div class="modal fade" id="cadastroColaboradorModal" tabindex="-1" aria-labelledby="cadastroColaboradorModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cadastroColaboradorModalLabel">Cadastro de Colaborador</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="colaboradorForm" onsubmit="cadastrarColaborador(event)">
                        <div class="mb-3">
                            <label for="nomeColaborador" class="form-label">Nome</label>
                            <input type="text" class="form-control" id="nomeColaborador" required>
                        </div>

                        <div class="mb-3">
                            <label for="cargoColaborador" class="form-label">Cargo</label>
                            <select class="form-select" id="cargoColaborador" required>
                                <option value="">Selecione o Cargo</option>
                                <option value="Ancião">Ancião</option>
                                <option value="Secretário">Secretário</option>
                                <option value="Coordenador">Coordenador</option>
                                <option value="Atendente">Atendente</option>
                                <option value="Músico">Músico</option>
                                <option value="Canto">Canto</option>
                                <option value="Auxiliar">Auxiliar</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="comumColaborador" class="form-label">Comum Congregação</label>
                            <select class="form-select" id="comumColaborador" required>
                                <option value="">Selecione a Comum</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="contatoColaborador" class="form-label">Contato</label>
                            <input type="tel" class="form-control" id="contatoColaborador" required>
                        </div>

                        <div class="mt-4">
                            <button type="submit" class="btn btn-success">Cadastrar Colaborador</button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="container">
            <div class="row g-4">
                <!-- Setor 1 -->
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <h3 class="card-title h5 fw-bold mb-3">SETOR 1</h3>
                            <p class="card-text">Unidades Prisionais Masculinas e Femininas, e para Menores</p>
                        </div>
                    </div>
                </div>

                <!-- Setor 2 -->
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <h3 class="card-title h5 fw-bold mb-3">SETOR 2</h3>
                            <p class="card-text">Clínica de Dependentes e Albergues</p>
                        </div>
                    </div>
                </div>

                <!-- Setor 3 -->
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <h3 class="card-title h5 fw-bold mb-3">SETOR 3</h3>
                            <p class="card-text">Forças de Segurança</p>
                        </div>
                    </div>
                </div>

                <!-- Setor 4 -->
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <h3 class="card-title h5 fw-bold mb-3">SETOR 4</h3>
                            <p class="card-text">Hospitais, Instituição para Idosos, Setor Educacional</p>
                        </div>
                    </div>
                </div>

                <!-- Projeto Educacional -->
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <h3 class="card-title h5 fw-bold mb-3">PROJETO EDUCACIONAL CRISTÃO</h3>
                            <p class="card-text">Desenvolvimento e acompanhamento do projeto educacional</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Cache para as unidades e comuns
        let unidadesCache = {};
        let comunsCache = [];

        // Função para carregar unidades do Firebase
        function carregarUnidades() {
            database.ref('unidades').on('value', (snapshot) => {
                const unidades = snapshot.val();
                if (unidades) {
                    // Limpar cache atual
                    unidadesCache = {};
                    
                    // Organizar unidades por setor
                    Object.entries(unidades).forEach(([key, unidade]) => {
                        if (!unidadesCache[unidade.setor]) {
                            unidadesCache[unidade.setor] = [];
                        }
                        unidadesCache[unidade.setor].push({
                            id: key,
                            ...unidade
                        });
                    });
                }
            });
        }

        // Função para carregar comuns do Firebase
        function carregarComuns() {
            database.ref('comuns').on('value', (snapshot) => {
                const comuns = snapshot.val();
                if (comuns) {
                    comunsCache = Object.entries(comuns).map(([id, comum]) => ({
                        id,
                        ...comum
                    }));
                    
                    // Atualizar select de comuns
                    const comumSelect = document.getElementById('comumColaborador');
                    comumSelect.innerHTML = '<option value="">Selecione a Comum</option>';
                    
                    comunsCache.forEach(comum => {
                        const option = document.createElement('option');
                        option.value = comum.id;
                        option.textContent = comum.nome;
                        comumSelect.appendChild(option);
                    });
                }
            });
        }

        // Função para carregar unidades do setor selecionado
        function carregarUnidadesDoSetor() {
            const setorSelect = document.getElementById('setor-agendamento');
            const unidadeSelect = document.getElementById('unidade-agendamento');
            const setor = setorSelect.value;

            // Limpar opções existentes
            unidadeSelect.innerHTML = '<option value="">Selecione a Unidade</option>';
            
            // Adicionar unidades do setor selecionado
            if (setor && unidadesCache[setor]) {
                unidadesCache[setor].forEach(unidade => {
                    const option = document.createElement('option');
                    option.value = unidade.id;
                    option.textContent = unidade.nome;
                    unidadeSelect.appendChild(option);
                });
            }
        }

        // Função para formatar telefone
        function formatarTelefone(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 11) value = value.slice(0, 11);
            
            if (value.length > 10) {
                value = value.replace(/^(\d{2})(\d{5})(\d{4}).*/, '($1) $2-$3');
            } else if (value.length > 6) {
                value = value.replace(/^(\d{2})(\d{4})(\d{0,4}).*/, '($1) $2-$3');
            } else if (value.length > 2) {
                value = value.replace(/^(\d{2})(\d{0,5})/, '($1) $2');
            } else if (value.length > 0) {
                value = value.replace(/^(\d*)/, '($1');
            }
            
            input.value = value;
        }

        // Função para cadastrar unidade
        function cadastrarUnidade(event) {
            event.preventDefault();
            
            const unidadeData = {
                nome: document.getElementById('nomeUnidade').value,
                endereco: document.getElementById('endereco').value,
                numero: document.getElementById('numero').value,
                bairro: document.getElementById('bairro').value,
                cidade: document.getElementById('cidade').value,
                uf: document.getElementById('uf').value,
                telefone: document.getElementById('telefone').value,
                responsavel: document.getElementById('responsavel').value,
                setor: document.getElementById('setor').value,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };

            // Salvar no Firebase
            database.ref('unidades').push(unidadeData)
                .then(() => {
                    alert('Unidade cadastrada com sucesso!');
                    document.getElementById('unidadeForm').reset();
                    bootstrap.Modal.getInstance(document.getElementById('cadastroUnidadeModal')).hide();
                })
                .catch((error) => {
                    alert('Erro ao cadastrar unidade: ' + error.message);
                });
        }

        // Função para cadastrar colaborador
        function cadastrarColaborador(event) {
            event.preventDefault();
            
            const colaboradorData = {
                nome: document.getElementById('nomeColaborador').value,
                cargo: document.getElementById('cargoColaborador').value,
                comum: {
                    id: document.getElementById('comumColaborador').value,
                    nome: document.getElementById('comumColaborador').options[
                        document.getElementById('comumColaborador').selectedIndex
                    ].text
                },
                contato: document.getElementById('contatoColaborador').value,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };

            // Salvar no Firebase
            database.ref('colaboradores').push(colaboradorData)
                .then(() => {
                    alert('Colaborador cadastrado com sucesso!');
                    document.getElementById('colaboradorForm').reset();
                    bootstrap.Modal.getInstance(document.getElementById('cadastroColaboradorModal')).hide();
                })
                .catch((error) => {
                    alert('Erro ao cadastrar colaborador: ' + error.message);
                });
        }

        // Função para submeter agendamento
        function submitAgendamento(event) {
            event.preventDefault();
            
            const setor = document.getElementById('setor-agendamento').value;
            const unidadeId = document.getElementById('unidade-agendamento').value;
            const unidadeSelecionada = unidadesCache[setor]?.find(u => u.id === unidadeId);
            
            if (!unidadeSelecionada) {
                alert('Por favor, selecione uma unidade válida.');
                return;
            }

            const formData = {
                unidade: {
                    id: unidadeSelecionada.id,
                    nome: unidadeSelecionada.nome,
                    endereco: unidadeSelecionada.endereco,
                    numero: unidadeSelecionada.numero,
                    bairro: unidadeSelecionada.bairro,
                    cidade: unidadeSelecionada.cidade,
                    uf: unidadeSelecionada.uf,
                    telefone: unidadeSelecionada.telefone,
                    responsavel: unidadeSelecionada.responsavel
                },
                setor: setor,
                data: document.getElementById('data-agendamento').value,
                horario: document.getElementById('horario-agendamento').value,
                coordenador: document.getElementById('coordenador-agendamento').value,
                atendente: document.getElementById('atendente-agendamento').value,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };

            // Salvar no Firebase
            database.ref('agendamentos').push(formData)
                .then(() => {
                    alert('Agendamento salvo com sucesso!');
                    document.getElementById('agendamentoForm').reset();
                    bootstrap.Modal.getInstance(document.getElementById('agendamentoModal')).hide();
                })
                .catch((error) => {
                    alert('Erro ao salvar agendamento: ' + error.message);
                });
        }

        // Adicionar máscara aos campos de telefone
        document.getElementById('telefone').addEventListener('input', function() {
            formatarTelefone(this);
        });

        document.getElementById('contatoColaborador').addEventListener('input', function() {
            formatarTelefone(this);
        });

        // Carregar dados ao inicializar a página
        document.addEventListener('DOMContentLoaded', () => {
            carregarUnidades();
            carregarComuns();
        });
    </script>
</body>
</html> 

