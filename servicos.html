<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Agenda de Coletas - CCB</title>

    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.0/dist/lux/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            /* Cores principais */
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            
            /* Cores de status */
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #2980b9;
            
            /* Cores de fundo */
            --light-bg: #f5f6fa;
            --card-bg: #ffffff;
            --hover-bg: #edf2f7;
            
            /* Cores de texto */
            --text-primary: #2c3e50;
            --text-secondary: #576574;
            --text-muted: #95a5a6;
            --text-light: #ffffff;
        }

        body {
            background-color: var(--light-bg);
            font-family: 'Inter', sans-serif;
            color: var(--text-primary);
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }

        .app-header {
            background-color: var(--card-bg);
            padding: 1.5rem;
            text-align: center;
            border-bottom: 1px solid #e1e8ef;
            margin-bottom: 2rem;
        }

        .app-title {
            font-size: 2rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .app-subtitle {
            color: var(--text-muted);
            font-size: 1.1rem;
        }

        .main-container {
            display: flex;
            gap: 2rem;
            padding: 0 2rem;
        }

        .congregacoes-section {
            flex: 1;
            max-width: 50%;
        }

        .agendamentos-section {
            flex: 1;
        }

        .congregacoes-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 1.2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .congregacoes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.8rem;
            border-bottom: 1px solid #e1e8ef;
        }

        .congregacoes-list {
            max-height: 70vh;
            overflow-y: auto;
            padding-right: 0.5rem;
            scrollbar-width: thin;
            scrollbar-color: var(--text-muted) transparent;
        }

        .congregacoes-list::-webkit-scrollbar {
            width: 4px;
        }

        .congregacoes-list::-webkit-scrollbar-thumb {
            background-color: var(--text-muted);
            border-radius: 2px;
        }

        .congregacoes-list::-webkit-scrollbar-track {
            background-color: transparent;
        }

        .botao-congregacao {
            white-space: normal;
            text-align: left;
            padding: 0.8rem 1rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            transition: all 0.2s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--card-bg);
            border: 1px solid #e1e8ef;
            font-weight: 500;
            font-size: 0.9rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .botao-congregacao:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
            border-color: var(--accent-color);
            background-color: rgba(52, 152, 219, 0.02);
        }

        .badge {
            padding: 0.35rem 0.6rem;
            font-weight: 500;
            font-size: 0.75rem;
            border-radius: 6px;
            letter-spacing: 0.3px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .badge.bg-success {
            background-color: #2ecc71 !important;
        }

        .badge.bg-primary {
            background-color: #3498db !important;
        }

        .badge.bg-info {
            background-color: #00b8d4 !important;
        }

        .badge.bg-warning {
            background-color: #f1c40f !important;
            color: #2c3e50 !important;
        }

        .badge.bg-secondary {
            background-color: #95a5a6 !important;
        }

        .badge i {
            font-size: 0.8rem;
            margin-right: 2px;
        }

        .export-buttons {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e1e8ef;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .table-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .container {
            background-color: var(--card-bg);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-top: 2rem;
            margin-bottom: 2rem;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            color: var(--primary-color);
        }

        h1 {
            font-size: 2.2rem;
            letter-spacing: -0.5px;
            border-bottom: 3px solid var(--accent-color);
            padding-bottom: 1rem;
            margin-bottom: 2rem;
        }

        .section-title {
            color: var(--secondary-color);
            font-size: 1.5rem;
            margin: 2rem 0 1rem;
            font-weight: 600;
        }

        .agendamento-futuro {
            background-color: #e8f6f0;
            transition: background-color 0.3s ease;
        }

        .agendamento-futuro:hover {
            background-color: #d1f2e4;
        }

        .table {
            background-color: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.03);
        }

        .table thead th {
            background-color: var(--primary-color);
            color: var(--text-light);
            border: none;
            padding: 1.2rem 1rem;
            font-weight: 600;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .table td {
            padding: 1.2rem 1rem;
            vertical-align: middle;
            color: var(--text-secondary);
            font-size: 0.95rem;
            border-color: #edf2f7;
        }

        .btn {
            border-radius: 8px;
            padding: 0.6rem 1.2rem;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .btn-primary {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
        }

        .btn-primary:hover {
            background-color: #2980b9;
            border-color: #2980b9;
            transform: translateY(-1px);
        }

        .btn-success {
            background-color: var(--success-color);
            border-color: var(--success-color);
        }

        .btn-warning {
            background-color: var(--warning-color);
            border-color: var(--warning-color);
        }

        .btn-danger {
            background-color: var(--danger-color);
            border-color: var(--danger-color);
        }

        .modal-content {
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border: none;
        }

        .modal-header {
            background-color: var(--primary-color);
            color: var(--text-light);
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
            padding: 1.5rem;
        }

        .modal-title {
            font-weight: 600;
            font-size: 1.2rem;
        }

        .form-label {
            color: var(--text-secondary);
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .form-control {
            border-radius: 8px;
            padding: 0.7rem 1rem;
            border-color: #e1e8ef;
            font-size: 0.95rem;
        }

        .form-control:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .alert-info {
            background-color: #e8f4fd;
            border-color: #bde0fe;
            border-radius: 12px;
            padding: 1.2rem;
            color: var(--info-color);
        }

        .alert-info ul {
            margin-bottom: 0;
            padding-left: 1.2rem;
        }

        .alert-info li {
            margin: 0.6rem 0;
            color: var(--text-secondary);
        }

        .toast-container {
            z-index: 9999;
        }

        .toast {
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .toast-body {
            font-size: 0.95rem;
            padding: 1rem 1.2rem;
        }

        .export-buttons {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #edf2f7;
        }

        .bi {
            font-size: 1.1rem;
            vertical-align: -0.125em;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            h1 {
                font-size: 1.8rem;
            }

            .botao-congregacao {
                font-size: 0.9rem;
                padding: 1rem;
            }

            .table td, .table th {
                padding: 0.8rem;
            }

            .badge {
                font-size: 0.8rem;
            }
        }

        @media (max-width: 992px) {
            .main-container {
                flex-direction: column;
                padding: 0 1rem;
            }

            .congregacoes-section {
                max-width: 100%;
            }

            .congregacoes-list {
                max-height: 40vh;
            }

            .app-title {
                font-size: 1.5rem;
            }

            .app-subtitle {
                font-size: 1rem;
            }
        }

        .legend {
            font-size: 0.8rem;
            line-height: 1.4;
        }

        .legend i {
            font-size: 0.75rem;
            margin-right: 3px;
        }

        /* Estilos para o ticker de agendamentos */
        .ticker-container {
            background-color: var(--primary-color);
            padding: 0.5rem 0;
            margin-bottom: 2rem;
            overflow: hidden;
            position: relative;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .ticker-container::before,
        .ticker-container::after {
            content: '';
            position: absolute;
            top: 0;
            width: 50px;
            height: 100%;
            z-index: 2;
        }

        .ticker-container::before {
            left: 0;
            background: linear-gradient(to right, var(--primary-color), transparent);
        }

        .ticker-container::after {
            right: 0;
            background: linear-gradient(to left, var(--primary-color), transparent);
        }

        .ticker-wrapper {
            display: flex;
            animation: ticker 3s linear infinite;
            white-space: nowrap;
            padding: 0 50px;
        }

        .ticker-wrapper:hover {
            animation-play-state: paused;
        }

        .ticker-item {
            display: inline-flex;
            align-items: center;
            color: white;
            padding: 0 2rem;
            font-size: 0.9rem;
            border-right: 2px solid rgba(255, 255, 255, 0.2);
        }

        .ticker-item:last-child {
            border-right: none;
        }

        .ticker-item i {
            margin-right: 0.5rem;
            font-size: 1rem;
        }

        .ticker-item .badge {
            margin-left: 0.5rem;
            font-size: 0.7rem;
            padding: 0.25rem 0.5rem;
        }

        @keyframes ticker {
            0% {
                transform: translateX(0);
            }
            100% {
                transform: translateX(-50%);
            }
        }
    </style>
</head>
<body>
    <header class="app-header">
        <h1 class="app-title">AGENDA DE REFORÇOS DE COLETAS</h1>
        <div class="app-subtitle">Administração de Ituiutaba-MG</div>
        <div class="app-subtitle">Referente ao mês de : JUNHO/2025</div>
        <div class="mt-3">
            <a href="servicos.html" class="btn btn-primary btn-lg">
                <i class="bi bi-calendar2-week me-2"></i>
                AGENDA DE SERVIÇOS
            </a>
        </div>
    </header>

    <div class="ticker-container">
        <div class="ticker-wrapper" id="ticker-wrapper">
            <!-- Os itens do ticker serão inseridos aqui via JavaScript -->
        </div>
    </div>

    <div class="main-container">
        <!-- Seção de Congregações -->
        <section class="congregacoes-section">
            <div class="congregacoes-container">
                <div class="congregacoes-header">
                    <h5 class="mb-0">
                        <i class="bi bi-building me-2"></i>Congregações
                    </h5>
                    <div class="legend">
                        <small class="text-muted d-block">
                            <i class="bi bi-check-circle-fill text-success"></i> Agendado
                        </small>
                        <small class="text-muted d-block">
                            <i class="bi bi-circle text-muted"></i> Disponível
                        </small>
                    </div>
                </div>
                
                <div class="congregacoes-list" id="congregacoes"></div>

                <div class="export-buttons">
                    <button id="btnExportPDF" class="btn btn-success">
                        <i class="bi bi-file-pdf me-2"></i>Baixar PDF
                    </button>
                    <button id="btnExportXLS" class="btn btn-primary">
                        <i class="bi bi-file-excel me-2"></i>Baixar XLS
                    </button>
                    <button id="btnExportPNG" class="btn btn-info">
                        <i class="bi bi-file-image me-2"></i>Baixar PNG
                    </button>
                </div>
            </div>
        </section>

        <!-- Seção de Agendamentos -->
        <section class="agendamentos-section">
            <div class="table-container">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="mb-0">
                        <i class="bi bi-calendar-check me-2"></i>Agendamentos
                    </h5>
                </div>
                <div class="table-responsive">
                    <table class="table table-bordered table-hover" id="tabela-agendamentos">
                        <thead class="table-dark">
                            <tr>
                                <th><i class="bi bi-building me-2"></i>Congregação</th>
                                <th><i class="bi bi-calendar3 me-2"></i>Data</th>
                                <th><i class="bi bi-person me-2"></i>Irmão</th>
                                <th><i class="bi bi-tag me-2"></i>Tipo</th>
                                <th><i class="bi bi-gear me-2"></i>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="lista-agendamentos"></tbody>
                    </table>
                </div>
            </div>
        </section>
    </div>

    <div class="modal fade" id="modalAgendamento" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <form id="formAgendamento" class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-calendar-plus me-2"></i>
                        Agendar Coleta
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-4">
                        <label class="form-label">
                            <i class="bi bi-building me-2"></i>
                            Congregação
                        </label>
                        <input type="text" class="form-control" id="congregacaoSelecionada" readonly />
                    </div>
                    <div class="mb-4">
                        <label for="dataColeta" class="form-label">
                            <i class="bi bi-calendar-date me-2"></i>
                            Data
                        </label>
                        <input type="date" class="form-control" id="dataColeta" required />
                    </div>
                    <div class="mb-4">
                        <label for="irmaoNome" class="form-label">
                            <i class="bi bi-person me-2"></i>
                            Nome do Irmão
                        </label>
                        <input type="text" class="form-control" id="irmaoNome" required />
                    </div>
                    <div class="mb-4">
                        <label for="tipoAgendamento" class="form-label">
                            <i class="bi bi-tag me-2"></i>
                            Tipo de Agendamento
                        </label>
                        <select class="form-select" id="tipoAgendamento" required>
                            <option value="">Selecione</option>
                            <option value="Culto Oficial">Culto Oficial</option>
                            <option value="Reunião de Jovens e Menores">Reunião de Jovens e Menores</option>
                        </select>
                    </div>
                    <div class="alert alert-info">
                        <div class="d-flex align-items-center mb-2">
                            <i class="bi bi-info-circle me-2"></i>
                            <strong>Horários Disponíveis:</strong>
                        </div>
                        <ul id="horarios-lista" class="mb-0"></ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-2"></i>Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check-circle me-2"></i>Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal fade" id="modalConfirmacaoExclusao" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        Confirmar Exclusão
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-danger mb-3">
                        <i class="bi bi-exclamation-circle-fill me-2"></i>
                        <strong>Atenção!</strong> Esta ação não poderá ser desfeita.
                    </div>
                    <p>Você está prestes a excluir o seguinte agendamento:</p>
                    <div class="card bg-light">
                        <div class="card-body">
                            <p class="mb-2"><strong>Congregação:</strong> <span id="congExclusao"></span></p>
                            <p class="mb-2"><strong>Data:</strong> <span id="dataExclusao"></span></p>
                            <p class="mb-2"><strong>Irmão:</strong> <span id="irmaoExclusao"></span></p>
                            <p class="mb-0"><strong>Tipo:</strong> <span id="tipoExclusao"></span></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-2"></i>Cancelar
                    </button>
                    <button type="button" class="btn btn-danger" id="btnPrimeiraConfirmacao">
                        <i class="bi bi-trash me-2"></i>Confirmar Exclusão
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
        import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDAZekCEenSVQuYPB2jGqdXc3sllfDqg-M",
            authDomain: "agendawebccb.firebaseapp.com",
            databaseURL: "https://agendawebccb-default-rtdb.firebaseio.com",
            projectId: "agendawebccb",
            storageBucket: "agendawebccb.firebasestorage.app",
            messagingSenderId: "1002090805726",
            appId: "1:1002090805726:web:d9aab35124d174e85d454f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const congregacoes = [
            "Alvorada", "Buritis", "Capinópolis - Central", "Cachoeira Dourada",
            "Chaveslândia", "Chico Mendes", "Dom Alexandre", "Eldorado",
            "Flor de Minas", "Gurinhatã", "Ipiaçu", "Ipiranga", "Ituiutaba - Central",
            "Jerônimo Mendonça", "Marta Helena", "Natal", "Novo Tempo II",
            "Recanto das Acácias", "Santa Vitória - Central", "Satélite Andradina",
            "Setor Norte"
        ].sort();

        let agendamentos = [];
        let congregacaoAtual = "";
        let indexEdicao = null;
        let agendamentoParaExcluir = null;
        let idParaExcluir = null;

        const modal = new bootstrap.Modal(document.getElementById("modalAgendamento"));

        // Horários fixos para cada congregação
        const horariosCongregacoes = {
            "Alvorada": {
                "Culto Oficial": [
                    { dia: "Segunda-feira", hora: "19:30" },
                    { dia: "Sábado", hora: "19:30" }
                ]
            },
            "Buritis": {
                "Culto Oficial": [
                    { dia: "Segunda-feira", hora: "19:30" },
                    { dia: "Sábado", hora: "19:30" }
                ]
                
            },
            "Capinópolis - Central": {
                "Culto Oficial": [
                    { dia: "Quinta-feira", hora: "19:30" },
                    { dia: "Domingo", hora: "18:30" }
                ],
                "Reunião de Jovens e Menores": [
                    { dia: "Domingo", hora: "10:00" }
                ]
            },
            "Cachoeira Dourada": {
                "Culto Oficial": [
                    { dia: "Quarta-feira", hora: "19:30" },
                    { dia: "Sábado", hora: "19:30" }
                ]
            },
            "Chaveslândia": {
                "Culto Oficial": [
                    { dia: "Sábado", hora: "19:30" },
                
                ]
            },
            "Chico Mendes": {
                "Culto Oficial": [
                    { dia: "Sábado - 1º e 3º ao mês", hora: "19:30" },
              
                ]
            },
            "Dom Alexandre": {
                "Culto Oficial": [
                    { dia: "Segunda-feira", hora: "19:30" },
                    { dia: "Sábado", hora: "19:30" }
            
                ]
            },
            "Eldorado": {
                "Culto Oficial": [
                    { dia: "Domingo", hora: "18:30" },
                    { dia: "Quinta-Feira", hora: "19:30" }
                ],
                "Reunião de Jovens e Menores": [
                    { dia: "Domingo", hora: "10:00" }
                ]
            },
            "Flor de Minas": {
                "Culto Oficial": [
                    { dia: "Sábado", hora: "19:30" }
                ],
                "Reunião de Jovens e Menores": [
                    { dia: "Domingo", hora: "10:00" }
                ]
            },
            "Gurinhatã": {
                "Culto Oficial": [
                    { dia: "Quarta-feira", hora: "19:30" },
                    { dia: "Domingo", hora: "18:30" }
                ],
                "Reunião de Jovens e Menores": [
                    { dia: "Sábado", hora: "19:30" }
                ]
            },
            "Ipiaçu": {
                "Culto Oficial": [
                    { dia: "Quarta-feira", hora: "19:30" },
                    { dia: "Domingo", hora: "18:30" }
            
                ]
            },
            "Ipiranga": {
                "Culto Oficial": [
                    { dia: "Terça-feira", hora: "19:30" },
                    { dia: "Domingo", hora: "18:30" }
                ],
                "Reunião de Jovens e Menores": [
                    { dia: "Domingo", hora: "10:00" }
                ]
            },
            "Ituiutaba - Central": {
                "Culto Oficial": [
                    { dia: "Domingo", hora: "18:30" },
                    { dia: "Quarta-feira", hora: "19:30" },
                     { dia: "Quinta-feira", hora: "15:00" },
                    { dia: "Sábado", hora: "19:30" }
                    
                ],
                "Reunião de Jovens e Menores": [
                    { dia: "Domingo", hora: "10:00" }
                ]
            },
            "Jerônimo Mendonça": {
                "Culto Oficial": [
                    { dia: "Terça-feira", hora: "19:30" },
                    { dia: "Domingo", hora: "18:30" }
    
                ]
            },
            "Marta Helena": {
                "Culto Oficial": [
                    { dia: "Terça-feira", hora: "19:30" },
                    { dia: "Sexta-feira", hora: "19:30" },
                    { dia: "Domingo", hora: "18:30" }
                ],
                "Reunião de Jovens e Menores": [
                    { dia: "Domingo", hora: "10:00" }
                ]
            },
            "Natal": {
                "Culto Oficial": [
                    { dia: "Segunda-feira", hora: "19:30" },
                    { dia: "Quinta-feira", hora: "19:30" },
                    { dia: "Domingo", hora: "18:30" }
                ],
                "Reunião de Jovens e Menores": [
                    { dia: "Domingo", hora: "10:00" }
                ]
            },
            "Novo Tempo II": {
                "Culto Oficial": [
                    { dia: "Quarta-feira", hora: "19:30" },
                    { dia: "Domingo", hora: "18:30" }
                ],
                "Reunião de Jovens e Menores": [
                    { dia: "Domingo", hora: "10:00" }
                ]
            },
            "Recanto das Acácias": {
                "Culto Oficial": [
                    { dia: "Quarta-feira", hora: "19:30" },
                    { dia: "Sexta-Feira", hora: "19:30" }
                ]
            },
            "Santa Vitória - Central": {
                "Culto Oficial": [
                    { dia: "Quarta-feira", hora: "19:30" },
                    { dia: "Domingo", hora: "18:30" }
                ],
                "Reunião de Jovens e Menores": [
                    { dia: "Domingo", hora: "10:00" }
                ]
            },
            "Satélite Andradina": {
                "Culto Oficial": [
                    { dia: "Quinta-feira", hora: "19:30" },
                    { dia: "Domingo", hora: "18:30" }
                ]
            },
            "Setor Norte": {
                "Culto Oficial": [
                    { dia: "Quarta-feira", hora: "19:30" },
                    { dia: "Domingo", hora: "18:30" }
                ]
            }
        };

        // Lista de congregações que têm reunião de jovens
        const congregacoesComReuniaoJovens = [
            "Ituiutaba - Central",
            "Ipiranga",
            "Eldorado",
            "Marta Helena",
            "Natal",
            "Novo Tempo II",
            "Gurinhatã",
            "Flor de Minas",
            "Santa Vitória - Central",
            "Capinópolis - Central"
        ];

        window.abrirFormulario = function (cong, index = null) {
            if (index !== null) {
                const agendamento = agendamentos[index];
                const dataFormatada = new Date(agendamento.data).toLocaleDateString("pt-BR");
                
                const mensagem = `Deseja editar este agendamento?\n\n` +
                    `Congregação: ${agendamento.congregacao}\n` +
                    `Data: ${dataFormatada}\n` +
                    `Irmão: ${agendamento.irmao}\n` +
                    `Tipo: ${agendamento.tipo}`;

                if (!confirm(mensagem)) {
                    return; // Se o usuário cancelar, não abre o modal
                }
            }

            congregacaoAtual = cong;
            indexEdicao = index;
            document.getElementById("congregacaoSelecionada").value = cong;
            document.getElementById("dataColeta").value = "";
            document.getElementById("irmaoNome").value = "";
            
            // Atualizar opções do tipo de agendamento
            const tipoSelect = document.getElementById("tipoAgendamento");
            tipoSelect.innerHTML = '<option value="">Selecione</option><option value="Culto Oficial">Culto Oficial</option>';
            
            // Adicionar opção de Reunião de Jovens apenas para congregações específicas
            if (congregacoesComReuniaoJovens.includes(cong)) {
                tipoSelect.innerHTML += '<option value="Reunião de Jovens e Menores">Reunião de Jovens e Menores</option>';
            }

            tipoSelect.value = "";

            if (index !== null) {
                const ag = agendamentos[index];
                document.getElementById("dataColeta").value = ag.data;
                document.getElementById("irmaoNome").value = ag.irmao;
                document.getElementById("tipoAgendamento").value = ag.tipo;
            }

            // Atualiza os horários exibidos
            const horariosDiv = document.querySelector("#modalAgendamento .alert-info ul");
            horariosDiv.innerHTML = "";
            const horarios = horariosCongregacoes[cong];
            Object.entries(horarios).forEach(([tipo, lista]) => {
                if (tipo === "Culto Oficial" || (tipo === "Reunião de Jovens e Menores" && congregacoesComReuniaoJovens.includes(cong))) {
                    lista.forEach(h => {
                        horariosDiv.innerHTML += `<li><strong>${tipo}:</strong> ${h.dia} às ${h.hora}</li>`;
                    });
                }
            });

            modal.show();
        };

        document.getElementById("formAgendamento").addEventListener("submit", async function (e) {
            e.preventDefault();
            const data = document.getElementById("dataColeta").value;
            const irmao = document.getElementById("irmaoNome").value;
            const tipo = document.getElementById("tipoAgendamento").value;
            const hoje = new Date().toLocaleDateString('en-CA'); // Formato YYYY-MM-DD

            if (!tipo) {
                alert("Por favor, selecione o tipo de agendamento.");
                return;
            }

            if (data < hoje) {
                alert("Não é permitido agendar uma data passada.");
                return;
            }

            // Criar data sem dependência de fuso horário
            const [ano, mes, dia] = data.split('-');
            const dataSelecionada = new Date(ano, mes - 1, dia);
            const diaSemana = dataSelecionada.getDay(); // 0 = Domingo, 4 = Quinta-feira

            // Validação especial para Ituiutaba - Central
            if (congregacaoAtual === "Ituiutaba - Central" && tipo === "Culto Oficial") {
                const cultosItuiutaba = agendamentos.filter(a => 
                    a.congregacao === "Ituiutaba - Central" && 
                    a.tipo === "Culto Oficial" &&
                    new Date(a.data).getMonth() === dataSelecionada.getMonth() &&
                    new Date(a.data).getFullYear() === dataSelecionada.getFullYear() &&
                    a.id !== (indexEdicao !== null ? agendamentos[indexEdicao].id : null)
                );

                if (cultosItuiutaba.length >= 2) {
                    alert("A Congregação Central de Ituiutaba já possui dois cultos agendados neste mês.");
                    return;
                }

                const temCultoQuinta = cultosItuiutaba.some(a => new Date(a.data).getDay() === 4);
                
                if (cultosItuiutaba.length === 1 && !temCultoQuinta && diaSemana !== 4) {
                    alert("O segundo culto deve ser obrigatoriamente na quinta-feira.");
                    return;
                }

                if (cultosItuiutaba.length === 0 && diaSemana === 4) {
                    // Permitir o primeiro agendamento na quinta-feira
                } else if (cultosItuiutaba.length === 0) {
                    // Permitir o primeiro agendamento em qualquer dia
                } else if (cultosItuiutaba.length === 1 && temCultoQuinta && diaSemana === 4) {
                    alert("Já existe um culto agendado para quinta-feira.");
                    return;
                }
            } else {
                // Validação normal para outras congregações
                const duplicado = agendamentos.some((a, i) => {
                    const dataAgendamento = new Date(a.data);
                    return (
                        a.congregacao === congregacaoAtual &&
                        dataAgendamento.getMonth() === dataSelecionada.getMonth() &&
                        dataAgendamento.getFullYear() === dataSelecionada.getFullYear() &&
                        a.tipo === tipo &&
                        i !== indexEdicao
                    );
                });

                if (duplicado) {
                    alert(`Já existe um agendamento de "${tipo}" para essa congregação neste mês.`);
                    return;
                }
            }

            const novo = { congregacao: congregacaoAtual, data, irmao, tipo };

            try {
                if (indexEdicao !== null && agendamentos[indexEdicao].id) {
                    const id = agendamentos[indexEdicao].id;
                    await set(ref(db, "agendamentos/" + id), novo);
                    mostrarAlerta("Agendamento atualizado com sucesso!", "success");
                } else {
                    await push(ref(db, "agendamentos"), novo);
                    mostrarAlerta("Novo agendamento criado com sucesso!", "success");
                }
                modal.hide();
            } catch (error) {
                mostrarAlerta("Erro ao salvar o agendamento. Tente novamente.", "danger");
            }
        });

        function atualizarTabela() {
            const corpo = document.getElementById("lista-agendamentos");
            corpo.innerHTML = "";
            const hoje = new Date();

            // Ordenar agendamentos por data
            agendamentos.sort((a, b) => {
                const [anoA, mesA, diaA] = a.data.split('-');
                const [anoB, mesB, diaB] = b.data.split('-');
                return new Date(anoA, mesA - 1, diaA) - new Date(anoB, mesB - 1, diaB);
            });

            agendamentos.forEach((a, index) => {
                const [ano, mes, dia] = a.data.split('-');
                const dataObj = new Date(ano, mes - 1, dia);
                const diaAbreviado = dataObj.toLocaleDateString("pt-BR", { weekday: "short" }).toLowerCase();
                const dataFormatada = dataObj.toLocaleDateString("pt-BR");
                const futura = dataObj >= new Date(hoje.getFullYear(), hoje.getMonth(), hoje.getDate());

                const linha = `
                  <tr class="${futura ? 'agendamento-futuro' : ''}" data-bs-toggle="tooltip" title="Clique nos botões para editar ou excluir">
                    <td>
                        <i class="bi bi-building me-2"></i>
                        ${a.congregacao}
                    </td>
                    <td>
                        <i class="bi bi-calendar3 me-1"></i>
                        <span class="text-capitalize">${diaAbreviado}</span> - ${dataFormatada}
                    </td>
                    <td>
                        <i class="bi bi-person me-2"></i>
                        ${a.irmao}
                    </td>
                    <td>
                        <span class="badge ${a.tipo === 'Culto Oficial' ? 'bg-primary' : 'bg-success'}">
                            <i class="bi ${a.tipo === 'Culto Oficial' ? 'bi-book' : 'bi-people'} me-1"></i>
                            ${a.tipo}
                        </span>
                    </td>
                    <td>
                        <div class="btn-group" role="group" aria-label="Ações">
                            <button class="btn btn-sm btn-warning" onclick="abrirFormulario('${a.congregacao}', ${index})" data-bs-toggle="tooltip" title="Editar agendamento">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="excluirAgendamento('${a.id}')" data-bs-toggle="tooltip" title="Excluir agendamento">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </td>
                  </tr>
                `;
                corpo.innerHTML += linha;
            });

            // Inicializar tooltips
            const tooltips = document.querySelectorAll('[data-bs-toggle="tooltip"]');
            tooltips.forEach(t => new bootstrap.Tooltip(t));

            atualizarIconesCongregacoes();
        }

        // Criar referências aos modais
        const modalExclusao = new bootstrap.Modal(document.getElementById('modalConfirmacaoExclusao'));

        // Função para excluir agendamento
        window.excluirAgendamento = async function (id) {
            const agendamento = agendamentos.find(a => a.id === id);
            
            if (!agendamento) {
                mostrarAlerta("Erro: Agendamento não encontrado.", "danger");
                return;
            }
            
            // Formatar a data
            const dataFormatada = new Date(agendamento.data).toLocaleDateString("pt-BR", {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                weekday: 'long'
            });

            // Preencher os dados no modal
            document.getElementById('congExclusao').textContent = agendamento.congregacao;
            document.getElementById('dataExclusao').textContent = dataFormatada;
            document.getElementById('irmaoExclusao').textContent = agendamento.irmao;
            document.getElementById('tipoExclusao').textContent = agendamento.tipo;

            // Armazenar o agendamento e ID para exclusão
            agendamentoParaExcluir = agendamento;
            idParaExcluir = id;

            // Mostrar o modal
            modalExclusao.show();
        };

        // Evento para confirmação de exclusão
        document.getElementById('btnPrimeiraConfirmacao').addEventListener('click', async () => {
            if (!agendamentoParaExcluir || !idParaExcluir) {
                mostrarAlerta("Erro: Agendamento não encontrado.", "danger");
                modalExclusao.hide();
                return;
            }

            try {
                const agendamentoRef = ref(db, `agendamentos/${idParaExcluir}`);
                await remove(agendamentoRef);
                mostrarAlerta("Agendamento excluído com sucesso!", "success");
                
                // Atualizar a interface
                await carregarAgendamentos();
            } catch (error) {
                console.error("Erro ao excluir:", error);
                mostrarAlerta("Erro ao excluir o agendamento. Tente novamente.", "danger");
            } finally {
                modalExclusao.hide();
                // Limpar as referências
                agendamentoParaExcluir = null;
                idParaExcluir = null;
            }
        });

        function carregarAgendamentos() {
            const agRef = ref(db, "agendamentos");
            onValue(agRef, snapshot => {
                agendamentos = [];
                snapshot.forEach(child => {
                    agendamentos.push({ ...child.val(), id: child.key });
                });
                atualizarTabela();
                atualizarIconesCongregacoes();
                atualizarTicker();
            });
        }

        function atualizarIconesCongregacoes() {
            const container = document.getElementById("congregacoes");
            container.innerHTML = "";

            congregacoes.forEach(c => {
                const col = document.createElement("div");
                const botao = document.createElement("button");
                botao.className = "btn btn-outline-primary w-100 botao-congregacao";

                const agendamentosCulto = agendamentos.filter(a => 
                    a.congregacao === c && 
                    a.tipo === "Culto Oficial"
                );
                const temReuniaoJovens = congregacoesComReuniaoJovens.includes(c);
                const agendamentoJovens = temReuniaoJovens && agendamentos.some(a => 
                    a.congregacao === c && 
                    a.tipo === "Reunião de Jovens e Menores"
                );

                let statusHtml = '';
                if (c === "Ituiutaba - Central") {
                    const cultosQuinta = agendamentosCulto.filter(a => new Date(a.data).getDay() === 4);
                    if (agendamentosCulto.length === 2 && cultosQuinta.length > 0 && agendamentoJovens) {
                        statusHtml = '<span class="badge bg-success"><i class="bi bi-check-double"></i> Todos Agendados</span>';
                    } else {
                        const badges = [];
                        if (cultosQuinta.length > 0) badges.push('<span class="badge bg-primary"><i class="bi bi-check-circle-fill"></i> Quinta</span>');
                        if (agendamentosCulto.length > cultosQuinta.length) badges.push('<span class="badge bg-primary"><i class="bi bi-check-circle-fill"></i> Culto da Tarde</span>');
                        if (agendamentoJovens) badges.push('<span class="badge bg-success"><i class="bi bi-check-circle-fill"></i> Jovens</span>');
                        statusHtml = badges.join(' ') || '<span class="badge bg-secondary"><i class="bi bi-circle"></i> Disponível</span>';
                    }
                } else if (temReuniaoJovens) {
                    if (agendamentosCulto.length > 0 && agendamentoJovens) {
                        statusHtml = '<span class="badge bg-success"><i class="bi bi-check-double"></i> Todos Agendados</span>';
                    } else if (agendamentosCulto.length > 0) {
                        statusHtml = '<span class="badge bg-primary"><i class="bi bi-check-circle-fill"></i> Culto</span>';
                    } else if (agendamentoJovens) {
                        statusHtml = '<span class="badge bg-success"><i class="bi bi-check-circle-fill"></i> Jovens</span>';
                    } else {
                        statusHtml = '<span class="badge bg-secondary"><i class="bi bi-circle"></i> Disponível</span>';
                    }
                } else {
                    if (agendamentosCulto.length > 0) {
                        statusHtml = '<span class="badge bg-success"><i class="bi bi-check-circle-fill"></i> Agendado</span>';
                    } else {
                        statusHtml = '<span class="badge bg-secondary"><i class="bi bi-circle"></i> Disponível</span>';
                    }
                }

                botao.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <i class="bi bi-building me-2"></i>${c}
                            ${c === "Ituiutaba - Central" ? 
                                '<small class="ms-2 badge bg-warning text-dark"><i class="bi bi-star-fill"></i> 2 Cultos</small>' : ''}
                            ${temReuniaoJovens ? '<small class="ms-2 badge bg-info"><i class="bi bi-people"></i> Jovens</small>' : ''}
                        </div>
                        <div class="d-flex gap-1">
                            ${statusHtml}
                        </div>
                    </div>
                `;
                
                botao.setAttribute('data-bs-toggle', 'tooltip');
                const tooltipText = c === "Ituiutaba - Central" ? 
                    'Clique para agendar (Permite 2 cultos, um na quinta-feira)' : 
                    `Clique para agendar${temReuniaoJovens ? ' (Culto/Jovens)' : ' (Culto)'}`;
                botao.setAttribute('title', tooltipText);
                botao.onclick = () => abrirFormulario(c);
                
                col.appendChild(botao);
                container.appendChild(col);
            });

            // Inicializar tooltips
            const tooltips = document.querySelectorAll('[data-bs-toggle="tooltip"]');
            tooltips.forEach(t => new bootstrap.Tooltip(t));
        }

        function atualizarTicker() {
            const tickerWrapper = document.getElementById('ticker-wrapper');
            tickerWrapper.innerHTML = '';

            // Ordenar agendamentos por data
            const agendamentosOrdenados = [...agendamentos].sort((a, b) => new Date(a.data) - new Date(b.data));

            // Duplicar os agendamentos para criar um efeito contínuo
            const todosAgendamentos = [...agendamentosOrdenados, ...agendamentosOrdenados];

            todosAgendamentos.forEach(agendamento => {
                const dataObj = new Date(agendamento.data + "T00:00");
                const dataFormatada = dataObj.toLocaleDateString("pt-BR", {
                    day: '2-digit',
                    month: '2-digit',
                    weekday: 'short'
                });

                const tickerItem = document.createElement('div');
                tickerItem.className = 'ticker-item';

                const tipoIcone = agendamento.tipo === 'Culto Oficial' ? 'bi-book' : 'bi-people';
                const tipoBadge = agendamento.tipo === 'Culto Oficial' ? 'bg-primary' : 'bg-success';

                tickerItem.innerHTML = `
                    <i class="bi bi-calendar-event"></i>
                    <span>${dataFormatada} - ${agendamento.congregacao} - ${agendamento.irmao}</span>
                    <span class="badge ${tipoBadge}">
                        <i class="bi ${tipoIcone}"></i>
                        ${agendamento.tipo}
                    </span>
                `;

                tickerWrapper.appendChild(tickerItem);
            });

            // Ajustar a animação com base no número de itens
            const tickerWidth = tickerWrapper.scrollWidth;
            tickerWrapper.style.animation = `ticker ${tickerWidth * 0.001}s linear infinite`;
        }

        function mostrarAlerta(mensagem, tipo) {
            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-white bg-${tipo} border-0`;
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'assertive');
            toast.setAttribute('aria-atomic', 'true');
            
            const icon = tipo === 'success' ? 'bi-check-circle' : 
                         tipo === 'danger' ? 'bi-exclamation-circle' : 'bi-info-circle';
            
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        <i class="bi ${icon} me-2"></i>
                        ${mensagem}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Fechar"></button>
                </div>
            `;
            
            let toastContainer = document.querySelector('.toast-container');
            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.className = 'toast-container position-fixed bottom-0 end-0 p-3';
                document.body.appendChild(toastContainer);
            }
            
            toastContainer.appendChild(toast);
            const bsToast = new bootstrap.Toast(toast, {
                delay: 3000
            });
            bsToast.show();
            
            toast.addEventListener('hidden.bs.toast', () => {
                toast.remove();
            });
        }

        carregarAgendamentos();
        atualizarIconesCongregacoes();

        document.getElementById("btnExportPDF").addEventListener("click", async () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Configurações iniciais
            doc.setFont("helvetica", "bold");
            doc.setFontSize(16);
            doc.text("AGENDA DE REFORÇOS DE COLETAS", 105, 20, { align: "center" });
            
            doc.setFontSize(12);
            doc.text("Administração de Ituiutaba-MG", 105, 30, { align: "center" });
            
            // Separar agendamentos por tipo
            const cultosOficiais = agendamentos
                .filter(a => a.tipo === "Culto Oficial")
                .sort((a, b) => new Date(a.data) - new Date(b.data));
            
            const reunioesJovens = agendamentos
                .filter(a => a.tipo === "Reunião de Jovens e Menores")
                .sort((a, b) => new Date(a.data) - new Date(b.data));

            // Função para formatar a data
            const formatarData = (data) => {
                const dataObj = new Date(data + "T00:00");
                const dia = dataObj.getDate().toString().padStart(2, '0');
                const mes = (dataObj.getMonth() + 1).toString().padStart(2, '0');
                const diaSemana = dataObj.toLocaleDateString("pt-BR", { weekday: "long" });
                return `${dia}/${mes} - ${diaSemana}`;
            };

            // Configurações da tabela
            const margemEsquerda = 15;
            const larguraUtil = doc.internal.pageSize.width - (2 * margemEsquerda);
            const alturaLinha = 7;
            const alturaCabecalho = 5; // Altura reduzida do cabeçalho
            const colunas = {
                data: { titulo: "Data", largura: larguraUtil * 0.35, x: margemEsquerda },
                local: { titulo: "Localidade", largura: larguraUtil * 0.35, x: margemEsquerda + (larguraUtil * 0.35) },
                irmao: { titulo: "Irmão", largura: larguraUtil * 0.30, x: margemEsquerda + (larguraUtil * 0.70) }
            };

            // Função para desenhar retângulo de fundo
            const desenharFundo = (y, altura) => {
                doc.setFillColor(240, 240, 240); // Cinza claro
                doc.rect(margemEsquerda, y - 4, larguraUtil, altura, 'F');
            };

            // Função para adicionar cabeçalho da tabela
            const adicionarCabecalhoTabela = (y) => {
                // Fundo do cabeçalho
                doc.setFillColor(51, 51, 51); // Cinza escuro quase preto
                doc.rect(margemEsquerda, y - 4, larguraUtil, alturaCabecalho, 'F');
                
                doc.setFont("helvetica", "bold");
                doc.setFontSize(10); // Tamanho reduzido para o cabeçalho
                doc.setTextColor(255, 255, 255); // Texto branco para o cabeçalho
                
                // Adicionar títulos das colunas
                Object.values(colunas).forEach(coluna => {
                    doc.text(coluna.titulo, coluna.x + 2, y);
                });
                
                doc.setTextColor(0, 0, 0); // Voltar para texto preto
                return y + alturaCabecalho;
            };

            // Função para adicionar uma seção com tabela
            const adicionarSecaoTabela = (titulo, dados, yInicial) => {
                let y = yInicial;
                
                // Título da seção
                doc.setFont("helvetica", "bold");
                doc.setFontSize(14);
                doc.text(titulo, margemEsquerda, y);
                y += 10;

                // Adicionar cabeçalho da tabela
                y = adicionarCabecalhoTabela(y);
                y += 3; // Espaço adicional após o cabeçalho

                // Adicionar dados
                doc.setFont("helvetica", "normal");
                doc.setFontSize(10);

                dados.forEach((item, index) => {
                    // Verificar se precisa de nova página
                    if (y > 270) {
                        doc.addPage();
                        y = 20;
                        y = adicionarCabecalhoTabela(y);
                        y += 3; // Espaço adicional após o cabeçalho na nova página
                    }

                    // Adicionar fundo cinza para linhas alternadas
                    if (index % 2 === 1) {
                        desenharFundo(y, alturaLinha);
                    }

                    // Adicionar texto
                    doc.text(formatarData(item.data), colunas.data.x + 2, y);
                    doc.text(item.congregacao, colunas.local.x + 2, y);
                    doc.text(item.irmao, colunas.irmao.x + 2, y);

                    y += alturaLinha;
                });

                return y + 10;
            };

            // Adicionar seção de Cultos Oficiais
            let proximoY = adicionarSecaoTabela("CULTOS OFICIAIS", cultosOficiais, 50);

            // Adicionar seção de Reuniões de Jovens e Menores
            if (reunioesJovens.length > 0) {
                // Se não houver espaço suficiente, adicionar nova página
                if (proximoY > 240) {
                    doc.addPage();
                    proximoY = 20;
                }
                adicionarSecaoTabela("REUNIÕES DE JOVENS E MENORES", reunioesJovens, proximoY);
            }

            // Adicionar rodapé com data de geração
            const dataGeracao = new Date().toLocaleDateString("pt-BR");
            doc.setFontSize(8);
            doc.text(`Relatório gerado em: ${dataGeracao}`, 105, 290, { align: "center" });

            doc.save("agenda_coletas.pdf");
        });

        document.getElementById("btnExportXLS").addEventListener("click", () => {
            const dados = agendamentos.map(a => {
                const dataObj = new Date(a.data + "T00:00");
                const diaAbrev = dataObj.toLocaleDateString("pt-BR", { weekday: "short" }).toLowerCase();
                const dataFormatada = dataObj.toLocaleDateString("pt-BR");

                return {
                    Congregação: a.congregacao,
                    Data: `${diaAbrev} - ${dataFormatada}`,
                    Irmão: a.irmao,
                    Tipo: a.tipo
                };
            });

            const ws = XLSX.utils.json_to_sheet(dados);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Agendamentos");

            XLSX.writeFile(wb, "agendamentos.xlsx");
        });

        document.getElementById("btnExportPNG").addEventListener("click", () => {
            // Ocultar a coluna de ações temporariamente
            const acoesHeaders = document.querySelectorAll('th:last-child');
            const acoesCells = document.querySelectorAll('td:last-child');
            
            // Guardar o display original
            const headerDisplays = Array.from(acoesHeaders).map(el => el.style.display);
            const cellDisplays = Array.from(acoesCells).map(el => el.style.display);
            
            // Ocultar elementos
            acoesHeaders.forEach(el => el.style.display = 'none');
            acoesCells.forEach(el => el.style.display = 'none');

            html2canvas(document.getElementById("tabela-agendamentos")).then(canvas => {
                // Restaurar a visibilidade dos elementos
                acoesHeaders.forEach((el, i) => el.style.display = headerDisplays[i] || '');
                acoesCells.forEach((el, i) => el.style.display = cellDisplays[i] || '');

                const link = document.createElement("a");
                link.download = "agendamentos.png";
                link.href = canvas.toDataURL();
                link.click();
            });
        });

        const alertaDiv = document.createElement('div');
        alertaDiv.id = 'mensagem-alerta';
        alertaDiv.className = 'alert alert-dismissible fade show d-none';
        alertaDiv.setAttribute('role', 'alert');
        alertaDiv.innerHTML = '<span id="texto-alerta"></span><button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>';
        document.querySelector('.container').prepend(alertaDiv);
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</body>
</html>
