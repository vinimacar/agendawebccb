<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Agenda de Coletas - CCB</title>

    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.0/dist/lux/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.0/dist/minty/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />

    <style>
        :root {
            --primary-color: #4a90e2;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --light-bg: #f8f9fa;
        }

        body {
            background-color: var(--light-bg);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .container {
            background-color: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            margin-top: 2rem;
            margin-bottom: 2rem;
        }

        h1 {
            color: var(--primary-color);
            font-weight: 600;
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 1rem;
            margin-bottom: 2rem;
        }

        .botao-congregacao {
            white-space: normal;
            text-align: left;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 10px;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .botao-congregacao:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .agendamento-futuro {
            background-color: #e7fbe7;
            transition: background-color 0.3s ease;
        }

        .agendamento-futuro:hover {
            background-color: #d4f8d4;
        }

        .agendado {
            color: var(--success-color);
            font-weight: 500;
        }

        .table {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
        }

        .table thead th {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 1rem;
        }

        .table td {
            padding: 1rem;
            vertical-align: middle;
        }

        .btn {
            border-radius: 8px;
            padding: 0.5rem 1rem;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .modal-content {
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
        }

        .modal-header {
            background-color: var(--primary-color);
            color: white;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
            padding: 1.5rem;
        }

        .modal-title {
            font-weight: 600;
        }

        .alert-info {
            background-color: #e8f4fd;
            border-color: #b8daff;
            border-radius: 10px;
            padding: 1rem;
        }

        .alert-info ul {
            margin-bottom: 0;
            padding-left: 1.2rem;
        }

        .alert-info li {
            margin: 0.5rem 0;
        }

        #congregacoes {
            margin-bottom: 3rem;
        }

        .section-title {
            color: var(--primary-color);
            margin: 2rem 0 1rem;
            font-weight: 500;
        }

        .export-buttons {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #dee2e6;
        }

        .status-icon {
            font-size: 1.2rem;
            margin-left: 0.5rem;
        }

        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.05);
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            h1 {
                font-size: 1.5rem;
            }

            .botao-congregacao {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body class="p-3">
    <div class="container">
        <header class="text-center mb-5">
            <h1 class="mb-3">AGENDA DE REFORÇOS DE COLETAS</h1>
            <h5 class="text-muted mb-2">Administração de Ituiutaba-MG</h5>
            <h6 class="text-primary">Referente ao mês de: JUNHO/2025</h6>
        </header>

        <section class="mb-5">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4 class="section-title mb-0">
                    <i class="bi bi-building me-2"></i>
                    Congregações
                </h4>
                <div class="legend d-flex align-items-center">
                    <small class="text-muted me-3">
                        <i class="bi bi-check-circle-fill text-success"></i> Agendado
                    </small>
                    <small class="text-muted">
                        <i class="bi bi-circle text-muted"></i> Disponível
                    </small>
                </div>
            </div>
            <div class="row row-cols-1 row-cols-md-2 g-2 mb-4" id="congregacoes"></div>
        </section>

        <section class="mb-5">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4 class="section-title mb-0">
                    <i class="bi bi-calendar-check me-2"></i>
                    Agendamentos
                </h4>
            </div>
            <div class="table-responsive">
                <table class="table table-bordered table-hover" id="tabela-agendamentos">
                    <thead class="table-dark">
                        <tr>
                            <th><i class="bi bi-building me-2"></i>Congregação</th>
                            <th><i class="bi bi-calendar3 me-2"></i>Data</th>
                            <th><i class="bi bi-person me-2"></i>Irmão</th>
                            <th><i class="bi bi-tag me-2"></i>Tipo</th>
                            <th><i class="bi bi-gear me-2"></i>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="lista-agendamentos"></tbody>
                </table>
            </div>
        </section>

        <section class="export-buttons">
            <div class="d-flex justify-content-end gap-2">
                <button id="btnExportPDF" class="btn btn-success">
                    <i class="bi bi-file-pdf me-2"></i>Baixar PDF
                </button>
                <button id="btnExportXLS" class="btn btn-primary">
                    <i class="bi bi-file-excel me-2"></i>Baixar XLS
                </button>
                <button id="btnExportPNG" class="btn btn-info">
                    <i class="bi bi-file-image me-2"></i>Baixar PNG
                </button>
            </div>
        </section>
    </div>

    <div class="modal fade" id="modalAgendamento" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <form id="formAgendamento" class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-calendar-plus me-2"></i>
                        Agendar Coleta
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-4">
                        <label class="form-label">
                            <i class="bi bi-building me-2"></i>
                            Congregação
                        </label>
                        <input type="text" class="form-control" id="congregacaoSelecionada" readonly />
                    </div>
                    <div class="mb-4">
                        <label for="dataColeta" class="form-label">
                            <i class="bi bi-calendar-date me-2"></i>
                            Data
                        </label>
                        <input type="date" class="form-control" id="dataColeta" required />
                    </div>
                    <div class="mb-4">
                        <label for="irmaoNome" class="form-label">
                            <i class="bi bi-person me-2"></i>
                            Nome do Irmão
                        </label>
                        <input type="text" class="form-control" id="irmaoNome" required />
                    </div>
                    <div class="mb-4">
                        <label for="tipoAgendamento" class="form-label">
                            <i class="bi bi-tag me-2"></i>
                            Tipo de Agendamento
                        </label>
                        <select class="form-select" id="tipoAgendamento" required>
                            <option value="">Selecione</option>
                            <option value="Culto Oficial">Culto Oficial</option>
                            <option value="Reunião de Jovens e Menores">Reunião de Jovens e Menores</option>
                        </select>
                    </div>
                    <div class="alert alert-info">
                        <div class="d-flex align-items-center mb-2">
                            <i class="bi bi-info-circle me-2"></i>
                            <strong>Horários Disponíveis:</strong>
                        </div>
                        <ul id="horarios-lista" class="mb-0"></ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-2"></i>Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check-circle me-2"></i>Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
        import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDAZekCEenSVQuYPB2jGqdXc3sllfDqg-M",
            authDomain: "agendawebccb.firebaseapp.com",
            databaseURL: "https://agendawebccb-default-rtdb.firebaseio.com",
            projectId: "agendawebccb",
            storageBucket: "agendawebccb.firebasestorage.app",
            messagingSenderId: "1002090805726",
            appId: "1:1002090805726:web:d9aab35124d174e85d454f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const congregacoes = [
            "Alvorada", "Buritis", "Capinópolis - Central", "Cachoeira Dourada",
            "Chaveslândia", "Chico Mendes", "Dom Alexandre", "Eldorado",
            "Flor de Minas", "Gurinhatã", "Ipiaçu", "Ipiranga", "Ituiutaba - Central",
            "Jerônimo Mendonça", "Marta Helena", "Natal", "Novo Tempo II",
            "Recanto das Acácias", "Santa Vitória - Central", "Satélite Andradina",
            "Setor Norte"
        ].sort();

        let agendamentos = [];
        let congregacaoAtual = "";
        let indexEdicao = null;

        const modal = new bootstrap.Modal(document.getElementById("modalAgendamento"));

        // Horários fixos para cada congregação
        const horariosCongregacoes = {
            "Alvorada": {
                "Culto Oficial": [
                    { dia: "Segunda-feira", hora: "19:30" },
                    { dia: "Sábado", hora: "19:30" }
                ]
            },
            "Buritis": {
                "Culto Oficial": [
                    { dia: "Segunda-feira", hora: "19:30" },
                    { dia: "Sábado", hora: "19:30" }
                ]
                
            },
            "Capinópolis - Central": {
                "Culto Oficial": [
                    { dia: "Quinta-feira", hora: "19:30" },
                    { dia: "Domingo", hora: "18:30" }
                ],
                "Reunião de Jovens e Menores": [
                    { dia: "Domingo", hora: "10:00" }
                ]
            },
            "Cachoeira Dourada": {
                "Culto Oficial": [
                    { dia: "Quarta-feira", hora: "19:30" },
                    { dia: "Sábado", hora: "19:30" }
                ]
            },
            "Chaveslândia": {
                "Culto Oficial": [
                    { dia: "Sábado", hora: "19:30" },
                
                ]
            },
            "Chico Mendes": {
                "Culto Oficial": [
                    { dia: "Sábado - 1º e 3º ao mês", hora: "19:30" },
              
                ]
            },
            "Dom Alexandre": {
                "Culto Oficial": [
                    { dia: "Segunda-feira", hora: "19:30" },
                    { dia: "Sábado", hora: "19:30" }
            
                ]
            },
            "Eldorado": {
                "Culto Oficial": [
                    { dia: "Domingo", hora: "18:30" },
                    { dia: "Quinta-Feira", hora: "19:30" }
                ],
                "Reunião de Jovens e Menores": [
                    { dia: "Domingo", hora: "10:00" }
                ]
            },
            "Flor de Minas": {
                "Culto Oficial": [
                    { dia: "Sábado", hora: "19:30" }
                ],
                "Reunião de Jovens e Menores": [
                    { dia: "Domingo", hora: "10:00" }
                ]
            },
            "Gurinhatã": {
                "Culto Oficial": [
                    { dia: "Quarta-feira", hora: "19:30" },
                    { dia: "Domingo", hora: "18:30" }
                ],
                "Reunião de Jovens e Menores": [
                    { dia: "Sábado", hora: "19:30" }
                ]
            },
            "Ipiaçu": {
                "Culto Oficial": [
                    { dia: "Quarta-feira", hora: "19:30" },
                    { dia: "Domingo", hora: "18:30" }
            
                ]
            },
            "Ipiranga": {
                "Culto Oficial": [
                    { dia: "Terça-feira", hora: "19:30" },
                    { dia: "Domingo", hora: "18:30" }
                ],
                "Reunião de Jovens e Menores": [
                    { dia: "Domingo", hora: "10:00" }
                ]
            },
            "Ituiutaba - Central": {
                "Culto Oficial": [
                    { dia: "Domingo", hora: "18:30" },
                    { dia: "Quarta-feira", hora: "19:30" },
                     { dia: "Quinta-feira", hora: "15:00" },
                    { dia: "Sábado", hora: "19:30" }
                    
                ],
                "Reunião de Jovens e Menores": [
                    { dia: "Domingo", hora: "10:00" }
                ]
            },
            "Jerônimo Mendonça": {
                "Culto Oficial": [
                    { dia: "Terça-feira", hora: "19:30" },
                    { dia: "Domingo", hora: "18:30" }
    
                ]
            },
            "Marta Helena": {
                "Culto Oficial": [
                    { dia: "Terça-feira", hora: "19:30" },
                    { dia: "Sexta-feira", hora: "19:30" },
                    { dia: "Domingo", hora: "18:30" }
                ],
                "Reunião de Jovens e Menores": [
                    { dia: "Domingo", hora: "10:00" }
                ]
            },
            "Natal": {
                "Culto Oficial": [
                    { dia: "Segunda-feira", hora: "19:30" },
                    { dia: "Quinta-feira", hora: "19:30" },
                    { dia: "Domingo", hora: "18:30" }
                ],
                "Reunião de Jovens e Menores": [
                    { dia: "Domingo", hora: "10:00" }
                ]
            },
            "Novo Tempo II": {
                "Culto Oficial": [
                    { dia: "Quarta-feira", hora: "19:30" },
                    { dia: "Domingo", hora: "18:30" }
                ],
                "Reunião de Jovens e Menores": [
                    { dia: "Domingo", hora: "10:00" }
                ]
            },
            "Recanto das Acácias": {
                "Culto Oficial": [
                    { dia: "Quarta-feira", hora: "19:30" },
                    { dia: "Sexta-Feira", hora: "19:30" }
                ]
            },
            "Santa Vitória - Central": {
                "Culto Oficial": [
                    { dia: "Quarta-feira", hora: "19:30" },
                    { dia: "Domingo", hora: "18:30" }
                ],
                "Reunião de Jovens e Menores": [
                    { dia: "Domingo", hora: "10:00" }
                ]
            },
            "Satélite Andradina": {
                "Culto Oficial": [
                    { dia: "Quinta-feira", hora: "19:30" },
                    { dia: "Domingo", hora: "18:30" }
                ]
            },
            "Setor Norte": {
                "Culto Oficial": [
                    { dia: "Quarta-feira", hora: "19:30" },
                    { dia: "Domingo", hora: "18:30" }
                ]
            }
        };

        window.abrirFormulario = function (cong, index = null) {
            congregacaoAtual = cong;
            indexEdicao = index;
            document.getElementById("congregacaoSelecionada").value = cong;
            document.getElementById("dataColeta").value = "";
            document.getElementById("irmaoNome").value = "";
            document.getElementById("tipoAgendamento").value = "";

            if (index !== null) {
                const ag = agendamentos[index];
                document.getElementById("dataColeta").value = ag.data;
                document.getElementById("irmaoNome").value = ag.irmao;
                document.getElementById("tipoAgendamento").value = ag.tipo;
            }

            // Atualiza os horários exibidos
            const horariosDiv = document.querySelector("#modalAgendamento .alert-info ul");
            horariosDiv.innerHTML = "";
            const horarios = horariosCongregacoes[cong];
            Object.entries(horarios).forEach(([tipo, lista]) => {
                lista.forEach(h => {
                    horariosDiv.innerHTML += `<li><strong>${tipo}:</strong> ${h.dia} às ${h.hora}</li>`;
                });
            });

            modal.show();
        };

        document.getElementById("formAgendamento").addEventListener("submit", async function (e) {
            e.preventDefault();
            const data = document.getElementById("dataColeta").value;
            const irmao = document.getElementById("irmaoNome").value;
            const tipo = document.getElementById("tipoAgendamento").value;
            const hoje = new Date().toISOString().split("T")[0];

            if (!tipo) {
                alert("Por favor, selecione o tipo de agendamento.");
                return;
            }

            if (data < hoje) {
                alert("Não é permitido agendar uma data passada.");
                return;
            }

            const duplicado = agendamentos.some((a, i) => {
                const dataAgendamento = new Date(a.data);
                const dataSelecionada = new Date(data);
                return (
                    a.congregacao === congregacaoAtual &&
                    dataAgendamento.getMonth() === dataSelecionada.getMonth() &&
                    dataAgendamento.getFullYear() === dataSelecionada.getFullYear() &&
                    a.tipo === tipo &&
                    i !== indexEdicao
                );
            });

            if (duplicado) {
                alert(`Já existe um agendamento de "${tipo}" para essa congregação neste mês.`);
                return;
            }

            const novo = { congregacao: congregacaoAtual, data, irmao, tipo };

            if (indexEdicao !== null && agendamentos[indexEdicao].id) {
                const id = agendamentos[indexEdicao].id;
                await set(ref(db, "agendamentos/" + id), novo);
            } else {
                await push(ref(db, "agendamentos"), novo);
            }

            modal.hide();
            mostrarAlerta("Agendamento salvo com sucesso!", "success");
        });

        function atualizarTabela() {
            const corpo = document.getElementById("lista-agendamentos");
            corpo.innerHTML = "";
            const hoje = new Date();

            // Ordenar agendamentos por data
            agendamentos.sort((a, b) => new Date(a.data) - new Date(b.data));

            agendamentos.forEach((a, index) => {
                const dataObj = new Date(a.data + "T00:00");
                const diaAbreviado = dataObj.toLocaleDateString("pt-BR", { weekday: "short" }).toLowerCase();
                const dataFormatada = dataObj.toLocaleDateString("pt-BR");
                const futura = dataObj >= new Date(hoje.toDateString());

                const linha = `
                  <tr class="${futura ? 'agendamento-futuro' : ''}" data-bs-toggle="tooltip" title="Clique nos botões para editar ou excluir">
                    <td>
                        <i class="bi bi-building me-2"></i>
                        ${a.congregacao}
                    </td>
                    <td>
                        <i class="bi bi-calendar3 me-1"></i>
                        <span class="text-capitalize">${diaAbreviado}</span> - ${dataFormatada}
                    </td>
                    <td>
                        <i class="bi bi-person me-2"></i>
                        ${a.irmao}
                    </td>
                    <td>
                        <span class="badge ${a.tipo === 'Culto Oficial' ? 'bg-primary' : 'bg-success'}">
                            <i class="bi ${a.tipo === 'Culto Oficial' ? 'bi-book' : 'bi-people'} me-1"></i>
                            ${a.tipo}
                        </span>
                    </td>
                    <td>
                        <div class="btn-group" role="group" aria-label="Ações">
                            <button class="btn btn-sm btn-warning" onclick="abrirFormulario('${a.congregacao}', ${index})" data-bs-toggle="tooltip" title="Editar agendamento">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="excluirAgendamento(${index})" data-bs-toggle="tooltip" title="Excluir agendamento">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </td>
                  </tr>
                `;
                corpo.innerHTML += linha;
            });

            // Inicializar tooltips
            const tooltips = document.querySelectorAll('[data-bs-toggle="tooltip"]');
            tooltips.forEach(t => new bootstrap.Tooltip(t));

            atualizarIconesCongregacoes();
        }

        window.excluirAgendamento = async function (index) {
            const id = agendamentos[index].id;
            if (confirm("Deseja realmente excluir este agendamento?")) {
                await remove(ref(db, "agendamentos/" + id));
            }
        };

        function carregarAgendamentos() {
            const agRef = ref(db, "agendamentos");
            onValue(agRef, snapshot => {
                agendamentos = [];
                snapshot.forEach(child => {
                    agendamentos.push({ ...child.val(), id: child.key });
                });
                atualizarTabela();
                atualizarIconesCongregacoes();
            });
        }

        function atualizarIconesCongregacoes() {
            const container = document.getElementById("congregacoes");
            container.innerHTML = "";

            congregacoes.forEach(c => {
                const col = document.createElement("div");
                const botao = document.createElement("button");
                botao.className = "btn btn-outline-primary w-100 botao-congregacao";

                const agendamentoCulto = agendamentos.some(a => a.congregacao === c && a.tipo === "Culto Oficial");
                const agendamentoJovens = agendamentos.some(a => a.congregacao === c && a.tipo === "Reunião de Jovens e Menores");

                let statusHtml = '';
                if (agendamentoCulto && agendamentoJovens) {
                    statusHtml = '<span class="badge bg-success"><i class="bi bi-check-double"></i> Todos Agendados</span>';
                } else if (agendamentoCulto) {
                    statusHtml = '<span class="badge bg-primary"><i class="bi bi-check-circle-fill"></i> Culto</span>';
                } else if (agendamentoJovens) {
                    statusHtml = '<span class="badge bg-success"><i class="bi bi-check-circle-fill"></i> Jovens</span>';
                } else {
                    statusHtml = '<span class="badge bg-secondary"><i class="bi bi-circle"></i> Disponível</span>';
                }

                botao.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-building me-2"></i>${c}</span>
                        ${statusHtml}
                    </div>
                `;
                
                botao.setAttribute('data-bs-toggle', 'tooltip');
                botao.setAttribute('title', 'Clique para agendar');
                botao.onclick = () => abrirFormulario(c);
                
                col.appendChild(botao);
                container.appendChild(col);
            });

            // Inicializar tooltips
            const tooltips = document.querySelectorAll('[data-bs-toggle="tooltip"]');
            tooltips.forEach(t => new bootstrap.Tooltip(t));
        }

        function mostrarAlerta(mensagem, tipo) {
            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-white bg-${tipo} border-0`;
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'assertive');
            toast.setAttribute('aria-atomic', 'true');
            
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        <i class="bi ${tipo === 'success' ? 'bi-check-circle' : 'bi-info-circle'} me-2"></i>
                        ${mensagem}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Fechar"></button>
                </div>
            `;
            
            // Adicionar container de toasts se não existir
            let toastContainer = document.querySelector('.toast-container');
            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.className = 'toast-container position-fixed bottom-0 end-0 p-3';
                document.body.appendChild(toastContainer);
            }
            
            toastContainer.appendChild(toast);
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
            
            // Remover toast após ser ocultado
            toast.addEventListener('hidden.bs.toast', () => {
                toast.remove();
            });
        }

        carregarAgendamentos();
        atualizarIconesCongregacoes();

        document.getElementById("btnExportPDF").addEventListener("click", async () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.text("Agenda de Coletas - CCB", 10, 10);

            let y = 20;
            agendamentos.forEach((a, index) => {
                const dataObj = new Date(a.data + "T00:00");
                const diaAbrev = dataObj.toLocaleDateString("pt-BR", { weekday: "short" }).toLowerCase();
                const dataFormatada = dataObj.toLocaleDateString("pt-BR");

                const linha = `${index + 1}. ${a.congregacao} - ${diaAbrev} - ${dataFormatada} - ${a.irmao} (${a.tipo})`;
                doc.text(linha, 10, y);
                y += 7;

                if (y > 270) {
                    doc.addPage();
                    y = 10;
                }
            });

            doc.save("agendamentos.pdf");
        });

        document.getElementById("btnExportXLS").addEventListener("click", () => {
            const dados = agendamentos.map(a => {
                const dataObj = new Date(a.data + "T00:00");
                const diaAbrev = dataObj.toLocaleDateString("pt-BR", { weekday: "short" }).toLowerCase();
                const dataFormatada = dataObj.toLocaleDateString("pt-BR");

                return {
                    Congregação: a.congregacao,
                    Data: `${diaAbrev} - ${dataFormatada}`,
                    Irmão: a.irmao,
                    Tipo: a.tipo
                };
            });

            const ws = XLSX.utils.json_to_sheet(dados);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Agendamentos");

            XLSX.writeFile(wb, "agendamentos.xlsx");
        });

        document.getElementById("btnExportPNG").addEventListener("click", () => {
            html2canvas(document.getElementById("tabela-agendamentos")).then(canvas => {
                const link = document.createElement("a");
                link.download = "agendamentos.png";
                link.href = canvas.toDataURL();
                link.click();
            });
        });

        const alertaDiv = document.createElement('div');
        alertaDiv.id = 'mensagem-alerta';
        alertaDiv.className = 'alert alert-dismissible fade show d-none';
        alertaDiv.setAttribute('role', 'alert');
        alertaDiv.innerHTML = '<span id="texto-alerta"></span><button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>';
        document.querySelector('.container').prepend(alertaDiv);
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
</body>
</html>
