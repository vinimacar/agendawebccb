<?php
session_start();
include('data/doces.php');

if (isset($_GET['add'])) {
    $id = $_GET['add'];
    if (!isset($_SESSION['cart'][$id])) {
        $_SESSION['cart'][$id] = 1;
    } else {
        $_SESSION['cart'][$id]++;
    }
    header("Location: cart.php");
    exit;
}

include('includes/header.php');
?>

<div class="container mt-5">
    <h2>Carrinho</h2>
    <?php if (!empty($_SESSION['cart'])): ?>
        <table class="table">
            <thead>
                <tr>
                    <th>Produto</th>
                    <th>Qtd</th>
                    <th>Pre√ßo</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
            <?php
            $total = 0;
            foreach ($_SESSION['cart'] as $id => $qtd):
                foreach ($doces as $doce):
                    if ($doce['id'] == $id):
                        $subtotal = $qtd * $doce['preco'];
                        $total += $subtotal;
            ?>
                        <tr>
                            <td><?= $doce['nome'] ?></td>
                            <td><?= $qtd ?></td>
                            <td>R$ <?= number_format($doce['preco'], 2, ',', '.') ?></td>
                            <td>R$ <?= number_format($subtotal, 2, ',', '.') ?></td>
                        </tr>
            <?php
                    endif;
                endforeach;
            endforeach;
            ?>
                <tr>
                    <td colspan="3" class="text-end"><strong>Total:</strong></td>
                    <td><strong>R$ <?= number_format($total, 2, ',', '.') ?></strong></td>
                </tr>
            </tbody>
        </table>
        <a href="checkout.php" class="btn btn-primary">Finalizar</a>
    <?php else: ?>
        <p>Carrinho vazio.</p>
    <?php endif; ?>
</div>

<?php include('includes/footer.php'); ?>
